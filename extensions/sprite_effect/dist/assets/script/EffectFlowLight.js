"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EffectFlowLight = void 0;
const cc_1 = require("cc");
const cc_2 = require("cc");
const cc_3 = require("cc");
const cc_4 = require("cc");
const cc_5 = require("cc");
const cc_6 = require("cc");
const cc_7 = require("cc");
const env_1 = require("cc/env");
const EffectBase_1 = require("./EffectBase");
const { ccclass, property, requireComponent, executeInEditMode } = cc_7._decorator;
let EffectFlowLight = class EffectFlowLight extends EffectBase_1.EffectBase {
    constructor() {
        super(...arguments);
        this._lightColor = new cc_2.Color(1, 1, 1, 1);
        this._lightWidth = 0.5;
        this._soft = 0.7;
        this._offset = -8.0;
        this._rotation = 2.4;
        //#endregion
        this.play = true;
        this.duration = 1.0;
        this.loop = true;
        this.loop_delay = 0.0;
        this.propsVec4 = new cc_7.Vec4();
    }
    //#region lightColor
    get lightColor() {
        return this._lightColor;
    }
    set lightColor(val) {
        this._lightColor.set(val);
        this._setParamsDirty('_lightColor');
    }
    //#endregion
    //#region lightWidth
    get lightWidth() {
        return this._lightWidth;
    }
    set lightWidth(val) {
        this._lightWidth = val;
        this._setParamsDirty('_lightProp');
    }
    //#endregion
    //#region soft
    get soft() {
        return this._soft;
    }
    set soft(val) {
        this._soft = val;
        this._setParamsDirty('_lightProp');
    }
    //#endregion
    //#region offset
    get offset() {
        return this._offset;
    }
    set offset(val) {
        this._offset = val;
        this._setParamsDirty('_lightProp');
    }
    //#endregion
    //#region rotation
    get rotation() {
        return this._rotation;
    }
    set rotation(val) {
        this._rotation = val;
        this._setParamsDirty('_lightProp');
    }
    onLoad() {
        if (!env_1.EDITOR && this.play) {
            this._offset = -3.0;
        }
        super.onLoad();
    }
    _instMaterial() {
        if (this.effectAsset) {
            let mat = new cc_4.Material();
            mat.initialize({
                effectAsset: this.effectAsset,
                defines: {},
                technique: this._is2Din3D ? 1 : 0
            });
            this._setParams('_baseUV', mat.passes[0].getHandle('_baseUV'));
            this._setParams('_lightColor', mat.passes[0].getHandle('_lightColor'));
            this._setParams('_lightProp', mat.passes[0].getHandle('_lightProp'));
            this._sprite.customMaterial = mat;
            if (this.play) {
                setTimeout(() => {
                    this._play();
                }, 10);
            }
        }
        else {
            cc_3.error('EffectFlowLight: effectAsset is null');
        }
    }
    _updateParams(key, idx) {
        var _a, _b, _c;
        if (key === '_baseUV') {
            (_a = this._sprite.material) === null || _a === void 0 ? void 0 : _a.passes[0].setUniform(idx, this._getUV(this._sprite.spriteFrame.uv));
        }
        else if (key === '_lightColor') {
            (_b = this._sprite.material) === null || _b === void 0 ? void 0 : _b.passes[0].setUniform(idx, this._lightColor);
        }
        else if (key === '_lightProp') {
            this.propsVec4.x = this._lightWidth;
            this.propsVec4.y = this._soft;
            this.propsVec4.z = this._offset;
            this.propsVec4.w = this._rotation;
            (_c = this._sprite.material) === null || _c === void 0 ? void 0 : _c.passes[0].setUniform(idx, this.propsVec4);
        }
    }
    _play() {
        let tweenTarget = { offset: -3.0 }; // Wrap the number in an object
        cc_1.tween(tweenTarget).to(this.duration, { offset: 3.0 }, {
            onUpdate: () => {
                this.offset = tweenTarget.offset;
            },
            onComplete: () => {
                if (this.loop) {
                    this.scheduleOnce(() => {
                        this._play();
                    }, this.loop_delay);
                }
            }
        }).start();
    }
};
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, tooltip: '流光颜色' })
], EffectFlowLight.prototype, "lightColor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, tooltip: '流光颜色', visible: true })
], EffectFlowLight.prototype, "_lightColor", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0.1, 2.0, 0.001], tooltip: '流光寬度' })
], EffectFlowLight.prototype, "lightWidth", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_5.CCFloat, slide: true, range: [0.1, 2.0, 0.001], tooltip: '流光寬度', visible: true })
], EffectFlowLight.prototype, "_lightWidth", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0.0, 10.0, 0.001], tooltip: '柔邊程度' })
], EffectFlowLight.prototype, "soft", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_5.CCFloat, slide: true, range: [0.0, 10.0, 0.001], tooltip: '柔邊程度', visible: true })
], EffectFlowLight.prototype, "_soft", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [-3.0, 3.0, 0.001], tooltip: '偏移量' })
], EffectFlowLight.prototype, "offset", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_5.CCFloat, slide: true, range: [-3.0, 3.0, 0.001], tooltip: '偏移量', visible: true })
], EffectFlowLight.prototype, "_offset", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0.0, 6.28, 0.1], tooltip: '流光角度' })
], EffectFlowLight.prototype, "rotation", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_5.CCFloat, slide: true, range: [0.0, 6.28, 0.1], tooltip: '流光角度', visible: true })
], EffectFlowLight.prototype, "_rotation", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, tooltip: '是否自動撥放' })
], EffectFlowLight.prototype, "play", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, type: cc_5.CCFloat, slide: true, range: [0.01, 10, 0.01], tooltip: '持续时间' })
], EffectFlowLight.prototype, "duration", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, tooltip: '是否循环' })
], EffectFlowLight.prototype, "loop", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, type: cc_5.CCFloat, slide: true, range: [0, 10, 0.1], tooltip: '循环间隔' })
], EffectFlowLight.prototype, "loop_delay", void 0);
EffectFlowLight = __decorate([
    ccclass('EffectFlowLight'),
    requireComponent(cc_6.Sprite),
    executeInEditMode(true)
], EffectFlowLight);
exports.EffectFlowLight = EffectFlowLight;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWZmZWN0Rmxvd0xpZ2h0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc291cmNlL2Fzc2V0cy9zY3JpcHQvRWZmZWN0Rmxvd0xpZ2h0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLDJCQUEyQjtBQUMzQiwyQkFBMkI7QUFDM0IsMkJBQTJCO0FBQzNCLDJCQUE4QjtBQUM5QiwyQkFBNkI7QUFDN0IsMkJBQTRCO0FBQzVCLDJCQUFzQztBQUN0QyxnQ0FBd0M7QUFDeEMsNkNBQTBDO0FBRTFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLEdBQUcsZUFBVSxDQUFDO0FBSzlFLElBQWEsZUFBZSxHQUE1QixNQUFhLGVBQWdCLFNBQVEsdUJBQVU7SUFBL0M7O1FBYVksZ0JBQVcsR0FBVSxJQUFJLFVBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQWdCM0MsZ0JBQVcsR0FBVyxHQUFHLENBQUM7UUFnQjFCLFVBQUssR0FBVyxHQUFHLENBQUM7UUFnQnBCLFlBQU8sR0FBVyxDQUFDLEdBQUcsQ0FBQztRQWdCdkIsY0FBUyxHQUFXLEdBQUcsQ0FBQztRQUNoQyxZQUFZO1FBSUwsU0FBSSxHQUFZLElBQUksQ0FBQztRQUdyQixhQUFRLEdBQVcsR0FBRyxDQUFDO1FBR3ZCLFNBQUksR0FBWSxJQUFJLENBQUM7UUFHckIsZUFBVSxHQUFXLEdBQUcsQ0FBQztRQUV4QixjQUFTLEdBQVMsSUFBSSxTQUFJLEVBQUUsQ0FBQztJQW1FekMsQ0FBQztJQS9KRyxvQkFBb0I7SUFFcEIsSUFBVyxVQUFVO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUM1QixDQUFDO0lBRUQsSUFBVyxVQUFVLENBQUMsR0FBVTtRQUM1QixJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxQixJ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QUcsRUFBRSxFQUFFLElBQUksRUFBRSxZQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQzttREFDaEY7QUEzRnZCLGVBQWU7SUFIM0IsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0lBQzFCLGdCQUFnQixDQUFDLFdBQU0sQ0FBQztJQUN4QixpQkFBaUIsQ0FBQyxJQUFJLENBQUM7R0FDWCxlQUFlLENBZ0szQjtBQWhLWSwwQ0FBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHR3ZWVuIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgQ29sb3IgfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBlcnJvciB9IGZyb20gJ2NjJztcbmltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgQ0NGbG9hdCB9IGZyb20gJ2NjJztcbmltcG9ydCB7IFNwcml0ZSB9IGZyb20gJ2NjJztcbmltcG9ydCB7IF9kZWNvcmF0b3IsIFZlYzQgfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBFRElUT1IsIFBSRVZJRVcgfSBmcm9tICdjYy9lbnYnXG5pbXBvcnQgeyBFZmZlY3RCYXNlIH0gZnJvbSAnLi9FZmZlY3RCYXNlJztcblxuY29uc3QgeyBjY2NsYXNzLCBwcm9wZXJ0eSwgcmVxdWlyZUNvbXBvbmVudCwgZXhlY3V0ZUluRWRpdE1vZGUgfSA9IF9kZWNvcmF0b3I7XG5cbkBjY2NsYXNzKCdFZmZlY3RGbG93TGlnaHQnKVxuQHJlcXVpcmVDb21wb25lbnQoU3ByaXRlKVxuQGV4ZWN1dGVJbkVkaXRNb2RlKHRydWUpXG5leHBvcnQgY2xhc3MgRWZmZWN0Rmxvd0xpZ2h0IGV4dGVuZHMgRWZmZWN0QmFzZSB7XG4gICAgLy8jcmVnaW9uIGxpZ2h0Q29sb3JcbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlNldHRlci9HZXR0ZXJcIiwgaWQ6IFwiMVwiIH0sIHRvb2x0aXA6ICfmtYHlhYnpopzoibInIH0pXG4gICAgcHVibGljIGdldCBsaWdodENvbG9yKCk6IENvbG9yIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpZ2h0Q29sb3I7XG4gICAgfVxuXG4gICAgcHVibGljIHNldCBsaWdodENvbG9yKHZhbDogQ29sb3IpIHtcbiAgICAgICAgdGhpcy5fbGlnaHRDb2xvci5zZXQodmFsKTtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ19saWdodENvbG9yJyk7XG4gICAgfVxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJQcml2YXRlIFByb3BzXCIsIGlkOiBcIjFcIiB9LCB0b29sdGlwOiAn5rWB5YWJ6aKc6ImyJywgdmlzaWJsZTogdHJ1ZSB9KVxuICAgIHByaXZhdGUgX2xpZ2h0Q29sb3I6IENvbG9yID0gbmV3IENvbG9yKDEsIDEsIDEsIDEpO1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICAvLyNyZWdpb24gbGlnaHRXaWR0aFxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMC4xLCAyLjAsIDAuMDAxXSwgdG9vbHRpcDogJ+a1geWFieWvrOW6picgfSlcbiAgICBwdWJsaWMgZ2V0IGxpZ2h0V2lkdGgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xpZ2h0V2lkdGg7XG4gICAgfVxuXG4gICAgcHVibGljIHNldCBsaWdodFdpZHRoKHZhbDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuX2xpZ2h0V2lkdGggPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfbGlnaHRQcm9wJyk7XG4gICAgfVxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJQcml2YXRlIFByb3BzXCIsIGlkOiBcIjFcIiB9LCB0eXBlOiBDQ0Zsb2F0LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLjEsIDIuMCwgMC4wMDFdLCB0b29sdGlwOiAn5rWB5YWJ5a+s5bqmJywgdmlzaWJsZTogdHJ1ZSB9KVxuICAgIHByaXZhdGUgX2xpZ2h0V2lkdGg6IG51bWJlciA9IDAuNTtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgLy8jcmVnaW9uIHNvZnRcbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlNldHRlci9HZXR0ZXJcIiwgaWQ6IFwiMVwiIH0sIHNsaWRlOiB0cnVlLCByYW5nZTogWzAuMCwgMTAuMCwgMC4wMDFdLCB0b29sdGlwOiAn5p+U6YKK56iL5bqmJyB9KVxuICAgIHB1YmxpYyBnZXQgc29mdCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fc29mdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IHNvZnQodmFsOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fc29mdCA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ19saWdodFByb3AnKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IENDRmxvYXQsIHNsaWRlOiB0cnVlLCByYW5nZTogWzAuMCwgMTAuMCwgMC4wMDFdLCB0b29sdGlwOiAn5p+U6YKK56iL5bqmJywgdmlzaWJsZTogdHJ1ZSB9KVxuICAgIHByaXZhdGUgX3NvZnQ6IG51bWJlciA9IDAuNztcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgLy8jcmVnaW9uIG9mZnNldFxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbLTMuMCwgMy4wLCAwLjAwMV0sIHRvb2x0aXA6ICflgY/np7vph48nIH0pXG4gICAgcHVibGljIGdldCBvZmZzZXQoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX29mZnNldDtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IG9mZnNldCh2YWw6IG51bWJlcikge1xuICAgICAgICB0aGlzLl9vZmZzZXQgPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfbGlnaHRQcm9wJyk7XG4gICAgfVxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJQcml2YXRlIFByb3BzXCIsIGlkOiBcIjFcIiB9LCB0eXBlOiBDQ0Zsb2F0LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFstMy4wLCAzLjAsIDAuMDAxXSwgdG9vbHRpcDogJ+WBj+enu+mHjycsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF9vZmZzZXQ6IG51bWJlciA9IC04LjA7XG4gICAgLy8jZW5kcmVnaW9uXG5cblxuICAgIC8vI3JlZ2lvbiByb3RhdGlvblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMC4wLCA2LjI4LCAwLjFdLCB0b29sdGlwOiAn5rWB5YWJ6KeS5bqmJyB9KVxuICAgIHB1YmxpYyBnZXQgcm90YXRpb24oKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JvdGF0aW9uO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgcm90YXRpb24odmFsOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fcm90YXRpb24gPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfbGlnaHRQcm9wJyk7XG4gICAgfVxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJQcml2YXRlIFByb3BzXCIsIGlkOiBcIjFcIiB9LCB0eXBlOiBDQ0Zsb2F0LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLjAsIDYuMjgsIDAuMV0sIHRvb2x0aXA6ICfmtYHlhYnop5LluqYnLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfcm90YXRpb246IG51bWJlciA9IDIuNDtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6eyBuYW1lOiBcIkFuaW1cIiwgaWQ6IFwiMlwiIH0sIHRvb2x0aXA6ICfmmK/lkKboh6rli5XmkqXmlL4nIH0pXG4gICAgcHVibGljIHBsYXk6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6eyBuYW1lOiBcIkFuaW1cIiwgaWQ6IFwiMlwiIH0sIHR5cGU6IENDRmxvYXQsIHNsaWRlOiB0cnVlLCByYW5nZTogWzAuMDEsIDEwLCAwLjAxXSwgdG9vbHRpcDogJ+aMgee7reaXtumXtCcgfSlcbiAgICBwdWJsaWMgZHVyYXRpb246IG51bWJlciA9IDEuMDtcblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOnsgbmFtZTogXCJBbmltXCIsIGlkOiBcIjJcIiB9LCB0b29sdGlwOiAn5piv5ZCm5b6q546vJyB9KVxuICAgIHB1YmxpYyBsb29wOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOnsgbmFtZTogXCJBbmltXCIsIGlkOiBcIjJcIiB9LCB0eXBlOiBDQ0Zsb2F0LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLCAxMCwgMC4xXSwgdG9vbHRpcDogJ+W+queOr+mXtOmalCcgfSlcbiAgICBwdWJsaWMgbG9vcF9kZWxheTogbnVtYmVyID0gMC4wO1xuXG4gICAgcHJpdmF0ZSBwcm9wc1ZlYzQ6IFZlYzQgPSBuZXcgVmVjNCgpO1xuXG4gICAgcHJvdGVjdGVkIG9uTG9hZCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKCFFRElUT1IgJiYgdGhpcy5wbGF5KSB7XG4gICAgICAgICAgICB0aGlzLl9vZmZzZXQgPSAtMy4wO1xuICAgICAgICB9XG4gICAgICAgIHN1cGVyLm9uTG9hZCgpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfaW5zdE1hdGVyaWFsKCk6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5lZmZlY3RBc3NldCkge1xuICAgICAgICAgICAgbGV0IG1hdDogTWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoKTtcbiAgICAgICAgICAgIG1hdC5pbml0aWFsaXplKHtcbiAgICAgICAgICAgICAgICBlZmZlY3RBc3NldDogdGhpcy5lZmZlY3RBc3NldCxcbiAgICAgICAgICAgICAgICBkZWZpbmVzOiB7ICB9LFxuICAgICAgICAgICAgICAgIHRlY2huaXF1ZTogdGhpcy5faXMyRGluM0QgPyAxIDogMFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2Jhc2VVVicsIG1hdC5wYXNzZXNbMF0uZ2V0SGFuZGxlKCdfYmFzZVVWJykpO1xuICAgICAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfbGlnaHRDb2xvcicsIG1hdC5wYXNzZXNbMF0uZ2V0SGFuZGxlKCdfbGlnaHRDb2xvcicpKTtcbiAgICAgICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2xpZ2h0UHJvcCcsIG1hdC5wYXNzZXNbMF0uZ2V0SGFuZGxlKCdfbGlnaHRQcm9wJykpO1xuXG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLmN1c3RvbU1hdGVyaWFsID0gbWF0O1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wbGF5KSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BsYXkoKTtcbiAgICAgICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBlcnJvcignRWZmZWN0Rmxvd0xpZ2h0OiBlZmZlY3RBc3NldCBpcyBudWxsJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX3VwZGF0ZVBhcmFtcyhrZXk6IHN0cmluZywgaWR4OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ19iYXNlVVYnKSB7XG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLm1hdGVyaWFsPy5wYXNzZXNbMF0uc2V0VW5pZm9ybShpZHgsIHRoaXMuX2dldFVWKHRoaXMuX3Nwcml0ZSEuc3ByaXRlRnJhbWUhLnV2KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnX2xpZ2h0Q29sb3InKSB7XG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLm1hdGVyaWFsPy5wYXNzZXNbMF0uc2V0VW5pZm9ybShpZHgsIHRoaXMuX2xpZ2h0Q29sb3IpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ19saWdodFByb3AnKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BzVmVjNC54ID0gdGhpcy5fbGlnaHRXaWR0aDtcbiAgICAgICAgICAgIHRoaXMucHJvcHNWZWM0LnkgPSB0aGlzLl9zb2Z0O1xuICAgICAgICAgICAgdGhpcy5wcm9wc1ZlYzQueiA9IHRoaXMuX29mZnNldDtcbiAgICAgICAgICAgIHRoaXMucHJvcHNWZWM0LncgPSB0aGlzLl9yb3RhdGlvbjtcblxuICAgICAgICAgICAgdGhpcy5fc3ByaXRlIS5tYXRlcmlhbD8ucGFzc2VzWzBdLnNldFVuaWZvcm0oaWR4LCB0aGlzLnByb3BzVmVjNCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9wbGF5KCk6IHZvaWQge1xuICAgICAgICBsZXQgdHdlZW5UYXJnZXQgPSB7IG9mZnNldDogLTMuMCB9OyAvLyBXcmFwIHRoZSBudW1iZXIgaW4gYW4gb2JqZWN0XG4gICAgICAgIHR3ZWVuKHR3ZWVuVGFyZ2V0KS50byh0aGlzLmR1cmF0aW9uLCB7IG9mZnNldDogMy4wIH0sIHtcbiAgICAgICAgICAgIG9uVXBkYXRlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vZmZzZXQgPSB0d2VlblRhcmdldC5vZmZzZXQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25Db21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9uY2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmxvb3BfZGVsYXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuc3RhcnQoKTtcbiAgICB9XG59XG5cblxuIl19