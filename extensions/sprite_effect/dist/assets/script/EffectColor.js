"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EffectColor = exports.BlurMode = exports.ColorMode = exports.ToneMode = void 0;
const cc_1 = require("cc");
const cc_2 = require("cc");
const cc_3 = require("cc");
const cc_4 = require("cc");
const cc_5 = require("cc");
const cc_6 = require("cc");
const cc_7 = require("cc");
const EffectBase_1 = require("./EffectBase");
const { ccclass, property } = cc_2._decorator;
var ToneMode;
(function (ToneMode) {
    ToneMode[ToneMode["GRAY"] = 0] = "GRAY";
    ToneMode[ToneMode["NEGA"] = 1] = "NEGA";
    ToneMode[ToneMode["SEPIA"] = 2] = "SEPIA";
    ToneMode[ToneMode["NORMAL"] = 3] = "NORMAL";
})(ToneMode = exports.ToneMode || (exports.ToneMode = {}));
var ColorMode;
(function (ColorMode) {
    ColorMode[ColorMode["ADD"] = 0] = "ADD";
    ColorMode[ColorMode["SUB"] = 1] = "SUB";
    ColorMode[ColorMode["FILL"] = 2] = "FILL";
    ColorMode[ColorMode["MULT"] = 3] = "MULT";
})(ColorMode = exports.ColorMode || (exports.ColorMode = {}));
var BlurMode;
(function (BlurMode) {
    BlurMode[BlurMode["NONE"] = 0] = "NONE";
    BlurMode[BlurMode["GAUSSIAN"] = 1] = "GAUSSIAN";
})(BlurMode = exports.BlurMode || (exports.BlurMode = {}));
let EffectColor = class EffectColor extends EffectBase_1.EffectBase {
    constructor() {
        super(...arguments);
        this._toneMode = ToneMode.NORMAL;
        this._toneFactor = 1.0;
        this._colorMode = ColorMode.MULT;
        this._colorFactor = 1.0;
        this._blurMode = BlurMode.NONE;
        this._blurFactor = 1.0;
        //#endregion
        this._blurTextureSize = new cc_5.Vec2(100, 100);
        this._contentSize = new cc_6.math.Size(100, 100);
        this._define_macro = {
            USE_COLOR_TONE_TRANSFORM: true,
            USE_NORMALIZE_UV: true,
            USE_BLUR: false,
            IS_GRAY: false,
            IS_NEGA: false,
            IS_SEPIA: false,
            IS_ADD: false,
            IS_SUB: false,
            IS_FILL: false,
            IS_MULT: false
        };
    }
    //#region toneMode
    get toneMode() {
        return this._toneMode;
    }
    set toneMode(val) {
        this._toneMode = val;
        this._setParamsDirty('_toneMode');
    }
    //#endregion
    //#region toneFactor
    get toneFactor() {
        return this._toneFactor;
    }
    set toneFactor(val) {
        this._toneFactor = val;
        this._setParamsDirty('_toneFactor');
    }
    //#endregion
    //#region colorMode
    get colorMode() {
        return this._colorMode;
    }
    set colorMode(val) {
        this._colorMode = val;
        this._setParamsDirty('_colorMode');
    }
    //#endregion
    //#region colorFactor
    get colorFactor() {
        return this._colorFactor;
    }
    set colorFactor(val) {
        this._colorFactor = val;
        this._setParamsDirty('_colorFactor');
    }
    //#endregion
    //#region blurMode
    get blurMode() {
        return this._blurMode;
    }
    set blurMode(val) {
        this._blurMode = val;
        this._setParamsDirty('_blurMode');
    }
    //#endregion
    //#region blurFactor
    get blurFactor() {
        return this._blurFactor;
    }
    set blurFactor(val) {
        this._blurFactor = val;
        this._setParamsDirty('_blurFactor');
    }
    _instMaterial() {
        this._contentSize = this._sprite.getComponent(cc_7.UITransform).contentSize;
        if (this.effectAsset) {
            switch (this._toneMode) {
                case ToneMode.GRAY:
                    this._define_macro.IS_GRAY = true;
                    break;
                case ToneMode.NEGA:
                    this._define_macro.IS_NEGA = true;
                    break;
                case ToneMode.SEPIA:
                    this._define_macro.IS_SEPIA = true;
                    break;
                case ToneMode.NORMAL:
                    break;
            }
            ;
            switch (this._colorMode) {
                case ColorMode.ADD:
                    this._define_macro.IS_ADD = true;
                    break;
                case ColorMode.SUB:
                    this._define_macro.IS_SUB = true;
                    break;
                case ColorMode.FILL:
                    this._define_macro.IS_FILL = true;
                    break;
                case ColorMode.MULT:
                    this._define_macro.IS_MULT = true;
                    break;
            }
            switch (this._blurMode) {
                case BlurMode.NONE:
                    this._define_macro.USE_BLUR = false;
                    break;
                case BlurMode.GAUSSIAN:
                    this._define_macro.USE_BLUR = true;
                    break;
            }
            this._reflashMaterial();
        }
        else {
            cc_3.error('EffectColor._instMaterial: effectAsset is null');
        }
    }
    _reflashMaterial() {
        let mat = new cc_1.Material();
        mat.initialize({
            effectAsset: this.effectAsset,
            defines: this._define_macro,
            technique: this._is2Din3D ? 1 : 0
        });
        this._setParams('_toneMode', -1);
        this._setParams('_colorMode', -1);
        this._setParams('_blurMode', -1);
        this._setParams('_baseUV', mat.passes[0].getHandle('baseUV'));
        this._setParams('_toneFactor', mat.passes[0].getHandle('toneFactor'));
        this._setParams('_colorFactor', mat.passes[0].getHandle('colorFactor'));
        this._setParams('_blurTextureSize', mat.passes[0].getHandle('blurTextureSize'));
        this._setParams('_blurFactor', mat.passes[0].getHandle('blurFactor'));
        this._sprite.customMaterial = mat;
    }
    _updateParams(key, idx) {
        var _a, _b, _c, _d, _e;
        if (key === '_baseUV') {
            (_a = this._sprite.material) === null || _a === void 0 ? void 0 : _a.passes[0].setUniform(idx, this._getUV(this._sprite.spriteFrame.uv));
        }
        else if (key === '_toneFactor') {
            (_b = this._sprite.material) === null || _b === void 0 ? void 0 : _b.passes[0].setUniform(idx, this._toneFactor);
        }
        else if (key === '_colorFactor') {
            (_c = this._sprite.material) === null || _c === void 0 ? void 0 : _c.passes[0].setUniform(idx, this._colorFactor);
        }
        else if (key === '_blurTextureSize') {
            const baseUV = this._getUV(this._sprite.spriteFrame.uv);
            if (this._sprite.spriteFrame) {
                this._blurTextureSize.x = Math.floor(this._sprite.spriteFrame.width * baseUV.z);
                this._blurTextureSize.y = Math.floor(this._sprite.spriteFrame.height * baseUV.w);
            }
            else {
                this._blurTextureSize.x = this._contentSize.width;
                this._blurTextureSize.y = this._contentSize.height;
            }
            (_d = this._sprite.material) === null || _d === void 0 ? void 0 : _d.passes[0].setUniform(idx, this._blurTextureSize);
        }
        else if (key === '_blurFactor') {
            (_e = this._sprite.material) === null || _e === void 0 ? void 0 : _e.passes[0].setUniform(idx, cc_6.math.lerp(0.0, 1.0, this._blurFactor));
        }
        else if (key === '_toneMode') {
            this._define_macro.IS_GRAY = false;
            this._define_macro.IS_NEGA = false;
            this._define_macro.IS_SEPIA = false;
            switch (this._toneMode) {
                case ToneMode.GRAY:
                    this._define_macro.IS_GRAY = true;
                    break;
                case ToneMode.NEGA:
                    this._define_macro.IS_NEGA = true;
                    break;
                case ToneMode.SEPIA:
                    this._define_macro.IS_SEPIA = true;
                    break;
                case ToneMode.NORMAL:
                    break;
            }
            ;
            this._reflashMaterial();
        }
        else if (key === '_colorMode') {
            this._define_macro.IS_ADD = false;
            this._define_macro.IS_SUB = false;
            this._define_macro.IS_FILL = false;
            this._define_macro.IS_MULT = false;
            switch (this._colorMode) {
                case ColorMode.ADD:
                    this._define_macro.IS_ADD = true;
                    break;
                case ColorMode.SUB:
                    this._define_macro.IS_SUB = true;
                    break;
                case ColorMode.FILL:
                    this._define_macro.IS_FILL = true;
                    break;
                case ColorMode.MULT:
                    this._define_macro.IS_MULT = true;
                    break;
            }
            this._reflashMaterial();
        }
        else if (key === '_blurMode') {
            switch (this._blurMode) {
                case BlurMode.NONE:
                    this._define_macro.USE_BLUR = false;
                    break;
                case BlurMode.GAUSSIAN:
                    this._define_macro.USE_BLUR = true;
                    break;
            }
            this._reflashMaterial();
        }
    }
    _is2Din3DChanged(enable) {
        this._reflashMaterial();
    }
};
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, type: cc_4.Enum(ToneMode), tooltip: "色調模式" })
], EffectColor.prototype, "toneMode", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_4.Enum(ToneMode), tooltip: "色調模式", visible: true })
], EffectColor.prototype, "_toneMode", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "色調程度" })
], EffectColor.prototype, "toneFactor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "色調程度", visible: true })
], EffectColor.prototype, "_toneFactor", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, type: cc_4.Enum(ColorMode), tooltip: "顏色模式" })
], EffectColor.prototype, "colorMode", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_4.Enum(ColorMode), tooltip: "顏色模式", visible: true })
], EffectColor.prototype, "_colorMode", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "顏色程度" })
], EffectColor.prototype, "colorFactor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "顏色程度", visible: true })
], EffectColor.prototype, "_colorFactor", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, type: cc_4.Enum(BlurMode), tooltip: "模糊模式" })
], EffectColor.prototype, "blurMode", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_4.Enum(BlurMode), tooltip: "模糊模式", visible: true })
], EffectColor.prototype, "_blurMode", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0.0, 1.0, 0.01], tooltip: "模糊程度" })
], EffectColor.prototype, "blurFactor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0.0, 1.0, 0.01], tooltip: "模糊程度", visible: true })
], EffectColor.prototype, "_blurFactor", void 0);
EffectColor = __decorate([
    ccclass('EffectColor')
], EffectColor);
exports.EffectColor = EffectColor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWZmZWN0Q29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zb3VyY2UvYXNzZXRzL3NjcmlwdC9FZmZlY3RDb2xvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSwyQkFBbUM7QUFDbkMsMkJBQWdDO0FBQ2hDLDJCQUEyQjtBQUMzQiwyQkFBMEI7QUFDMUIsMkJBQTBCO0FBQzFCLDJCQUEwQjtBQUMxQiwyQkFBaUM7QUFDakMsNkNBQTBDO0FBRTFDLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEdBQUcsZUFBVSxDQUFDO0FBRXpDLElBQVksUUFLWDtBQUxELFdBQVksUUFBUTtJQUNoQix1Q0FBSSxDQUFBO0lBQ0osdUNBQUksQ0FBQTtJQUNKLHlDQUFLLENBQUE7SUFDTCwyQ0FBTSxDQUFBO0FBQ1YsQ0FBQyxFQUxXLFFBQVEsR0FBUixnQkFBUSxLQUFSLGdCQUFRLFFBS25CO0FBRUQsSUFBWSxTQUtYO0FBTEQsV0FBWSxTQUFTO0lBQ2pCLHVDQUFHLENBQUE7SUFDSCx1Q0FBRyxDQUFBO0lBQ0gseUNBQUksQ0FBQTtJQUNKLHlDQUFJLENBQUE7QUFDUixDQUFDLEVBTFcsU0FBUyxHQUFULGlCQUFTLEtBQVQsaUJBQVMsUUFLcEI7QUFFRCxJQUFZLFFBR1g7QUFIRCxXQUFZLFFBQVE7SUFDaEIsdUNBQUksQ0FBQTtJQUNKLCtDQUFRLENBQUE7QUFDWixDQUFDLEVBSFcsUUFBUSxHQUFSLGdCQUFRLEtBQVIsZ0JBQVEsUUFHbkI7QUFHRCxJQUFhLFdBQVcsR0FBeEIsTUFBYSxXQUFZLFNBQVEsdUJBQVU7SUFBM0M7O1FBYVksY0FBUyxHQUFhLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFnQnRDLGdCQUFXLEdBQVcsR0FBRyxDQUFDO1FBZ0IxQixlQUFVLEdBQWMsU0FBUyxDQUFDLElBQUksQ0FBQztRQWdCdkMsaUJBQVksR0FBVyxHQUFHLENBQUM7UUFnQjNCLGNBQVMsR0FBYSxRQUFRLENBQUMs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QUFRLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUM7MkNBRzlGO0FBUUQ7SUFEQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsU0FBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDOzhDQUNsRTtBQU01QztJQURDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUM7NkNBRzlHO0FBUUQ7SUFEQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7Z0RBQzVGO0FBN0Z6QixXQUFXO0lBRHZCLE9BQU8sQ0FBQyxhQUFhLENBQUM7R0FDVixXQUFXLENBOFF2QjtBQTlRWSxrQ0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1hdGVyaWFsLCBsb2cgfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBfZGVjb3JhdG9yIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgZXJyb3IgfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBFbnVtIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgVmVjMiB9IGZyb20gJ2NjJztcbmltcG9ydCB7IG1hdGggfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBVSVRyYW5zZm9ybSB9IGZyb20gJ2NjJztcbmltcG9ydCB7IEVmZmVjdEJhc2UgfSBmcm9tICcuL0VmZmVjdEJhc2UnO1xuXG5jb25zdCB7IGNjY2xhc3MsIHByb3BlcnR5IH0gPSBfZGVjb3JhdG9yO1xuXG5leHBvcnQgZW51bSBUb25lTW9kZSB7XG4gICAgR1JBWSxcbiAgICBORUdBLFxuICAgIFNFUElBLFxuICAgIE5PUk1BTFxufVxuXG5leHBvcnQgZW51bSBDb2xvck1vZGUge1xuICAgIEFERCxcbiAgICBTVUIsXG4gICAgRklMTCxcbiAgICBNVUxUXG59XG5cbmV4cG9ydCBlbnVtIEJsdXJNb2RlIHtcbiAgICBOT05FLFxuICAgIEdBVVNTSUFOXG59XG5cbkBjY2NsYXNzKCdFZmZlY3RDb2xvcicpXG5leHBvcnQgY2xhc3MgRWZmZWN0Q29sb3IgZXh0ZW5kcyBFZmZlY3RCYXNlIHtcbiAgICAvLyNyZWdpb24gdG9uZU1vZGVcbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlNldHRlci9HZXR0ZXJcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IEVudW0oVG9uZU1vZGUpLCB0b29sdGlwOiBcIuiJsuiqv+aooeW8j1wiIH0pXG4gICAgcHVibGljIGdldCB0b25lTW9kZSgpOiBUb25lTW9kZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90b25lTW9kZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IHRvbmVNb2RlKHZhbDogVG9uZU1vZGUpIHtcbiAgICAgICAgdGhpcy5fdG9uZU1vZGUgPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfdG9uZU1vZGUnKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IEVudW0oVG9uZU1vZGUpLCB0b29sdGlwOiBcIuiJsuiqv+aooeW8j1wiLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfdG9uZU1vZGU6IFRvbmVNb2RlID0gVG9uZU1vZGUuTk9STUFMO1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICAvLyNyZWdpb24gdG9uZUZhY3RvclxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMCwgMSwgMC4wMV0sIHRvb2x0aXA6IFwi6Imy6Kq/56iL5bqmXCIgfSlcbiAgICBwdWJsaWMgZ2V0IHRvbmVGYWN0b3IoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RvbmVGYWN0b3I7XG4gICAgfVxuXG4gICAgcHVibGljIHNldCB0b25lRmFjdG9yKHZhbDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuX3RvbmVGYWN0b3IgPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfdG9uZUZhY3RvcicpO1xuICAgIH1cblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiUHJpdmF0ZSBQcm9wc1wiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMCwgMSwgMC4wMV0sIHRvb2x0aXA6IFwi6Imy6Kq/56iL5bqmXCIsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF90b25lRmFjdG9yOiBudW1iZXIgPSAxLjA7XG4gICAgLy8jZW5kcmVnaW9uXG5cblxuICAgIC8vI3JlZ2lvbiBjb2xvck1vZGVcbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlNldHRlci9HZXR0ZXJcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IEVudW0oQ29sb3JNb2RlKSwgdG9vbHRpcDogXCLpoY/oibLmqKHlvI9cIiB9KVxuICAgIHB1YmxpYyBnZXQgY29sb3JNb2RlKCk6IENvbG9yTW9kZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb2xvck1vZGU7XG4gICAgfVxuXG4gICAgcHVibGljIHNldCBjb2xvck1vZGUodmFsOiBDb2xvck1vZGUpIHtcbiAgICAgICAgdGhpcy5fY29sb3JNb2RlID0gdmFsO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXNEaXJ0eSgnX2NvbG9yTW9kZScpO1xuICAgIH1cblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiUHJpdmF0ZSBQcm9wc1wiLCBpZDogXCIxXCIgfSwgdHlwZTogRW51bShDb2xvck1vZGUpLCB0b29sdGlwOiBcIumhj+iJsuaooeW8j1wiLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfY29sb3JNb2RlOiBDb2xvck1vZGUgPSBDb2xvck1vZGUuTVVMVDtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgLy8jcmVnaW9uIGNvbG9yRmFjdG9yXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJTZXR0ZXIvR2V0dGVyXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLCAxLCAwLjAxXSwgdG9vbHRpcDogXCLpoY/oibLnqIvluqZcIn0pXG4gICAgcHVibGljIGdldCBjb2xvckZhY3RvcigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29sb3JGYWN0b3I7XG4gICAgfVxuXG4gICAgcHVibGljIHNldCBjb2xvckZhY3Rvcih2YWw6IG51bWJlcikge1xuICAgICAgICB0aGlzLl9jb2xvckZhY3RvciA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ19jb2xvckZhY3RvcicpO1xuICAgIH1cblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiUHJpdmF0ZSBQcm9wc1wiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMCwgMSwgMC4wMV0sIHRvb2x0aXA6IFwi6aGP6Imy56iL5bqmXCIsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF9jb2xvckZhY3RvcjogbnVtYmVyID0gMS4wO1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICAvLyNyZWdpb24gYmx1ck1vZGVcbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlNldHRlci9HZXR0ZXJcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IEVudW0oQmx1ck1vZGUpLCB0b29sdGlwOiBcIuaooeeziuaooeW8j1wiIH0pXG4gICAgcHVibGljIGdldCBibHVyTW9kZSgpOiBCbHVyTW9kZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ibHVyTW9kZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IGJsdXJNb2RlKHZhbDogQmx1ck1vZGUpIHtcbiAgICAgICAgdGhpcy5fYmx1ck1vZGUgPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfYmx1ck1vZGUnKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IEVudW0oQmx1ck1vZGUpLCB0b29sdGlwOiBcIuaooeeziuaooeW8j1wiLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfYmx1ck1vZGU6IEJsdXJNb2RlID0gQmx1ck1vZGUuTk9ORTtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgLy8jcmVnaW9uIGJsdXJGYWN0b3JcbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlNldHRlci9HZXR0ZXJcIiwgaWQ6IFwiMVwiIH0sIHNsaWRlOiB0cnVlLCByYW5nZTogWzAuMCwgMS4wLCAwLjAxXSwgdG9vbHRpcDogXCLmqKHns4rnqIvluqZcIiB9KVxuICAgIHB1YmxpYyBnZXQgYmx1ckZhY3RvcigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fYmx1ckZhY3RvcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IGJsdXJGYWN0b3IodmFsOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fYmx1ckZhY3RvciA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ19ibHVyRmFjdG9yJyk7XG4gICAgfVxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJQcml2YXRlIFByb3BzXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLjAsIDEuMCwgMC4wMV0sIHRvb2x0aXA6IFwi5qih57OK56iL5bqmXCIsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF9ibHVyRmFjdG9yOiBudW1iZXIgPSAxLjA7XG4gICAgLy8jZW5kcmVnaW9uXG5cbiAgICBwcml2YXRlIF9ibHVyVGV4dHVyZVNpemU6IFZlYzIgPSBuZXcgVmVjMigxMDAsIDEwMCk7XG4gICAgcHJpdmF0ZSBfY29udGVudFNpemU6IG1hdGguU2l6ZSA9IG5ldyBtYXRoLlNpemUoMTAwLCAxMDApO1xuICAgIFxuICAgIHByaXZhdGUgX2RlZmluZV9tYWNybyA9IHtcbiAgICAgICAgVVNFX0NPTE9SX1RPTkVfVFJBTlNGT1JNOiB0cnVlLFxuICAgICAgICBVU0VfTk9STUFMSVpFX1VWOiB0cnVlLFxuICAgICAgICBVU0VfQkxVUjogZmFsc2UsXG5cbiAgICAgICAgSVNfR1JBWTogZmFsc2UsXG4gICAgICAgIElTX05FR0E6IGZhbHNlLFxuICAgICAgICBJU19TRVBJQTogZmFsc2UsXG4gICAgICAgIElTX0FERDogZmFsc2UsXG4gICAgICAgIElTX1NVQjogZmFsc2UsXG4gICAgICAgIElTX0ZJTEw6IGZhbHNlLFxuICAgICAgICBJU19NVUxUOiBmYWxzZVxuICAgIH07XG5cbiAgICBwcm90ZWN0ZWQgX2luc3RNYXRlcmlhbCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5fY29udGVudFNpemUgPSB0aGlzLl9zcHJpdGUhLmdldENvbXBvbmVudChVSVRyYW5zZm9ybSkhLmNvbnRlbnRTaXplO1xuXG4gICAgICAgIGlmICh0aGlzLmVmZmVjdEFzc2V0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX3RvbmVNb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBUb25lTW9kZS5HUkFZOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfR1JBWSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVG9uZU1vZGUuTkVHQTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX05FR0EgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFRvbmVNb2RlLlNFUElBOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfU0VQSUEgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFRvbmVNb2RlLk5PUk1BTDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX2NvbG9yTW9kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JNb2RlLkFERDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX0FERCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JNb2RlLlNVQjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX1NVQiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JNb2RlLkZJTEw6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19GSUxMID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBDb2xvck1vZGUuTVVMVDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX01VTFQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9ibHVyTW9kZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgQmx1ck1vZGUuTk9ORTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLlVTRV9CTFVSID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgQmx1ck1vZGUuR0FVU1NJQU46XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5VU0VfQkxVUiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9yZWZsYXNoTWF0ZXJpYWwoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVycm9yKCdFZmZlY3RDb2xvci5faW5zdE1hdGVyaWFsOiBlZmZlY3RBc3NldCBpcyBudWxsJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF9yZWZsYXNoTWF0ZXJpYWwoKTogdm9pZCB7XG4gICAgICAgIGxldCBtYXQ6IE1hdGVyaWFsID0gbmV3IE1hdGVyaWFsKCk7XG4gICAgICAgIG1hdC5pbml0aWFsaXplKHtcbiAgICAgICAgICAgIGVmZmVjdEFzc2V0OiB0aGlzLmVmZmVjdEFzc2V0LFxuICAgICAgICAgICAgZGVmaW5lczogdGhpcy5fZGVmaW5lX21hY3JvLFxuICAgICAgICAgICAgdGVjaG5pcXVlOiB0aGlzLl9pczJEaW4zRCA/IDEgOiAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuX3NldFBhcmFtcygnX3RvbmVNb2RlJywgLTEpO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXMoJ19jb2xvck1vZGUnLCAtMSk7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2JsdXJNb2RlJywgLTEpO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXMoJ19iYXNlVVYnLCBtYXQucGFzc2VzWzBdLmdldEhhbmRsZSgnYmFzZVVWJykpO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXMoJ190b25lRmFjdG9yJywgbWF0LnBhc3Nlc1swXS5nZXRIYW5kbGUoJ3RvbmVGYWN0b3InKSk7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2NvbG9yRmFjdG9yJywgbWF0LnBhc3Nlc1swXS5nZXRIYW5kbGUoJ2NvbG9yRmFjdG9yJykpO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXMoJ19ibHVyVGV4dHVyZVNpemUnLCBtYXQucGFzc2VzWzBdLmdldEhhbmRsZSgnYmx1clRleHR1cmVTaXplJykpO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXMoJ19ibHVyRmFjdG9yJywgbWF0LnBhc3Nlc1swXS5nZXRIYW5kbGUoJ2JsdXJGYWN0b3InKSk7XG5cbiAgICAgICAgdGhpcy5fc3ByaXRlIS5jdXN0b21NYXRlcmlhbCA9IG1hdDtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX3VwZGF0ZVBhcmFtcyhrZXk6IHN0cmluZywgaWR4OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ19iYXNlVVYnKSB7XG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLm1hdGVyaWFsPy5wYXNzZXNbMF0uc2V0VW5pZm9ybShpZHgsIHRoaXMuX2dldFVWKHRoaXMuX3Nwcml0ZSEuc3ByaXRlRnJhbWUhLnV2KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnX3RvbmVGYWN0b3InKSB7XG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLm1hdGVyaWFsPy5wYXNzZXNbMF0uc2V0VW5pZm9ybShpZHgsIHRoaXMuX3RvbmVGYWN0b3IpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ19jb2xvckZhY3RvcicpIHtcbiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZSEubWF0ZXJpYWw/LnBhc3Nlc1swXS5zZXRVbmlmb3JtKGlkeCwgdGhpcy5fY29sb3JGYWN0b3IpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ19ibHVyVGV4dHVyZVNpemUnKSB7XG4gICAgICAgICAgICBjb25zdCBiYXNlVVYgPSB0aGlzLl9nZXRVVih0aGlzLl9zcHJpdGUhLnNwcml0ZUZyYW1lIS51dik7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLl9zcHJpdGUhLnNwcml0ZUZyYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYmx1clRleHR1cmVTaXplLnggPSBNYXRoLmZsb29yKHRoaXMuX3Nwcml0ZSEuc3ByaXRlRnJhbWUud2lkdGggKiBiYXNlVVYueik7XG4gICAgICAgICAgICAgICAgdGhpcy5fYmx1clRleHR1cmVTaXplLnkgPSBNYXRoLmZsb29yKHRoaXMuX3Nwcml0ZSEuc3ByaXRlRnJhbWUuaGVpZ2h0ICogYmFzZVVWLncpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYmx1clRleHR1cmVTaXplLnggPSB0aGlzLl9jb250ZW50U2l6ZS53aWR0aDtcbiAgICAgICAgICAgICAgICB0aGlzLl9ibHVyVGV4dHVyZVNpemUueSA9IHRoaXMuX2NvbnRlbnRTaXplLmhlaWdodDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fc3ByaXRlIS5tYXRlcmlhbD8ucGFzc2VzWzBdLnNldFVuaWZvcm0oaWR4LCB0aGlzLl9ibHVyVGV4dHVyZVNpemUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ19ibHVyRmFjdG9yJykge1xuICAgICAgICAgICAgdGhpcy5fc3ByaXRlIS5tYXRlcmlhbD8ucGFzc2VzWzBdLnNldFVuaWZvcm0oaWR4LCBtYXRoLmxlcnAoMC4wLCAxLjAsIHRoaXMuX2JsdXJGYWN0b3IpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdfdG9uZU1vZGUnKSB7XG4gICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfR1JBWSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX05FR0EgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19TRVBJQSA9IGZhbHNlO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX3RvbmVNb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBUb25lTW9kZS5HUkFZOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfR1JBWSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVG9uZU1vZGUuTkVHQTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX05FR0EgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFRvbmVNb2RlLlNFUElBOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfU0VQSUEgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFRvbmVNb2RlLk5PUk1BTDpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0aGlzLl9yZWZsYXNoTWF0ZXJpYWwoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdfY29sb3JNb2RlJykge1xuICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX0FERCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX1NVQiA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX0ZJTEwgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19NVUxUID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fY29sb3JNb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBDb2xvck1vZGUuQUREOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfQUREID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBDb2xvck1vZGUuU1VCOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfU1VCID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBDb2xvck1vZGUuRklMTDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX0ZJTEwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIENvbG9yTW9kZS5NVUxUOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfTVVMVCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9yZWZsYXNoTWF0ZXJpYWwoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdfYmx1ck1vZGUnKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX2JsdXJNb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBCbHVyTW9kZS5OT05FOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uVVNFX0JMVVIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBCbHVyTW9kZS5HQVVTU0lBTjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLlVTRV9CTFVSID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3JlZmxhc2hNYXRlcmlhbCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9pczJEaW4zRENoYW5nZWQoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuX3JlZmxhc2hNYXRlcmlhbCgpO1xuICAgIH1cbn1cblxuXG4iXX0=