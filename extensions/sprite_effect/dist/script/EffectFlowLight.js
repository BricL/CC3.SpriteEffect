"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EffectFlowLight = void 0;
const cc_1 = require("cc");
const cc_2 = require("cc");
const cc_3 = require("cc");
const cc_4 = require("cc");
const cc_5 = require("cc");
const cc_6 = require("cc");
const cc_7 = require("cc");
const env_1 = require("cc/env");
const EffectBase_1 = require("./EffectBase");
const { ccclass, property, requireComponent, executeInEditMode } = cc_7._decorator;
let EffectFlowLight = class EffectFlowLight extends EffectBase_1.EffectBase {
    constructor() {
        super(...arguments);
        this._lightColor = new cc_2.Color(1, 1, 1, 1);
        this._lightWidth = 0.5;
        this._soft = 0.7;
        this._offset = -8.0;
        this._rotation = 2.4;
        //#endregion
        this.play = true;
        this.duration = 1.0;
        this.loop = true;
        this.loop_delay = 0.0;
        this.propsVec4 = new cc_7.Vec4();
    }
    //#region lightColor
    get lightColor() {
        return this._lightColor;
    }
    set lightColor(val) {
        this._lightColor.set(val);
        this._setParamsDirty('_lightColor');
    }
    //#endregion
    //#region lightWidth
    get lightWidth() {
        return this._lightWidth;
    }
    set lightWidth(val) {
        this._lightWidth = val;
        this._setParamsDirty('_lightProp');
    }
    //#endregion
    //#region soft
    get soft() {
        return this._soft;
    }
    set soft(val) {
        this._soft = val;
        this._setParamsDirty('_lightProp');
    }
    //#endregion
    //#region offset
    get offset() {
        return this._offset;
    }
    set offset(val) {
        this._offset = val;
        this._setParamsDirty('_lightProp');
    }
    //#endregion
    //#region rotation
    get rotation() {
        return this._rotation;
    }
    set rotation(val) {
        this._rotation = val;
        this._setParamsDirty('_lightProp');
    }
    onLoad() {
        if (!env_1.EDITOR && this.play) {
            this._offset = -3.0;
        }
        super.onLoad();
    }
    _instMaterial() {
        if (this.effectAsset) {
            let mat = new cc_4.Material();
            mat.initialize({
                effectAsset: this.effectAsset,
                defines: {},
                technique: this._is2Din3D ? 1 : 0
            });
            this._setParams('_baseUV', mat.passes[0].getHandle('_baseUV'));
            this._setParams('_lightColor', mat.passes[0].getHandle('_lightColor'));
            this._setParams('_lightProp', mat.passes[0].getHandle('_lightProp'));
            this._sprite.customMaterial = mat;
            if (this.play) {
                setTimeout(() => {
                    this._play();
                }, 10);
            }
        }
        else {
            cc_3.error('EffectFlowLight: effectAsset is null');
        }
    }
    _updateParams(key, idx) {
        var _a, _b, _c;
        if (key === '_baseUV') {
            (_a = this._sprite.material) === null || _a === void 0 ? void 0 : _a.passes[0].setUniform(idx, this._getUV(this._sprite.spriteFrame.uv));
        }
        else if (key === '_lightColor') {
            (_b = this._sprite.material) === null || _b === void 0 ? void 0 : _b.passes[0].setUniform(idx, this._lightColor);
        }
        else if (key === '_lightProp') {
            this.propsVec4.x = this._lightWidth;
            this.propsVec4.y = this._soft;
            this.propsVec4.z = this._offset;
            this.propsVec4.w = this._rotation;
            (_c = this._sprite.material) === null || _c === void 0 ? void 0 : _c.passes[0].setUniform(idx, this.propsVec4);
        }
    }
    _play() {
        let tweenTarget = { offset: -3.0 }; // Wrap the number in an object
        cc_1.tween(tweenTarget).to(this.duration, { offset: 3.0 }, {
            onUpdate: () => {
                this.offset = tweenTarget.offset;
            },
            onComplete: () => {
                if (this.loop) {
                    this.scheduleOnce(() => {
                        this._play();
                    }, this.loop_delay);
                }
            }
        }).start();
    }
};
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, tooltip: '流光颜色' })
], EffectFlowLight.prototype, "lightColor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, tooltip: '流光颜色', visible: true })
], EffectFlowLight.prototype, "_lightColor", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0.1, 2.0, 0.001], tooltip: '流光寬度' })
], EffectFlowLight.prototype, "lightWidth", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_5.CCFloat, slide: true, range: [0.1, 2.0, 0.001], tooltip: '流光寬度', visible: true })
], EffectFlowLight.prototype, "_lightWidth", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0.0, 10.0, 0.001], tooltip: '柔邊程度' })
], EffectFlowLight.prototype, "soft", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_5.CCFloat, slide: true, range: [0.0, 10.0, 0.001], tooltip: '柔邊程度', visible: true })
], EffectFlowLight.prototype, "_soft", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [-3.0, 3.0, 0.001], tooltip: '偏移量' })
], EffectFlowLight.prototype, "offset", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_5.CCFloat, slide: true, range: [-3.0, 3.0, 0.001], tooltip: '偏移量', visible: true })
], EffectFlowLight.prototype, "_offset", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0.0, 6.28, 0.1], tooltip: '流光角度' })
], EffectFlowLight.prototype, "rotation", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_5.CCFloat, slide: true, range: [0.0, 6.28, 0.1], tooltip: '流光角度', visible: true })
], EffectFlowLight.prototype, "_rotation", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, tooltip: '是否自動撥放' })
], EffectFlowLight.prototype, "play", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, type: cc_5.CCFloat, slide: true, range: [0.01, 10, 0.01], tooltip: '持续时间' })
], EffectFlowLight.prototype, "duration", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, tooltip: '是否循环' })
], EffectFlowLight.prototype, "loop", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, type: cc_5.CCFloat, slide: true, range: [0, 10, 0.1], tooltip: '循环间隔' })
], EffectFlowLight.prototype, "loop_delay", void 0);
EffectFlowLight = __decorate([
    ccclass('EffectFlowLight'),
    requireComponent(cc_6.Sprite),
    executeInEditMode(true)
], EffectFlowLight);
exports.EffectFlowLight = EffectFlowLight;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWZmZWN0Rmxvd0xpZ2h0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc291cmNlL3NjcmlwdC9FZmZlY3RGbG93TGlnaHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsMkJBQTJCO0FBQzNCLDJCQUEyQjtBQUMzQiwyQkFBMkI7QUFDM0IsMkJBQThCO0FBQzlCLDJCQUE2QjtBQUM3QiwyQkFBNEI7QUFDNUIsMkJBQXNDO0FBQ3RDLGdDQUF3QztBQUN4Qyw2Q0FBMEM7QUFFMUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsZ0JBQWdCLEVBQUUsaUJBQWlCLEVBQUUsR0FBRyxlQUFVLENBQUM7QUFLOUUsSUFBYSxlQUFlLEdBQTVCLE1BQWEsZUFBZ0IsU0FBUSx1QkFBVTtJQUEvQzs7UUFhWSxnQkFBVyxHQUFVLElBQUksVUFBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBZ0IzQyxnQkFBVyxHQUFXLEdBQUcsQ0FBQztRQWdCMUIsVUFBSyxHQUFXLEdBQUcsQ0FBQztRQWdCcEIsWUFBTyxHQUFXLENBQUMsR0FBRyxDQUFDO1FBZ0J2QixjQUFTLEdBQVcsR0FBRyxDQUFDO1FBQ2hDLFlBQVk7UUFJTCxTQUFJLEdBQVksSUFBSSxDQUFDO1FBR3JCLGFBQVEsR0FBVyxHQUFHLENBQUM7UUFHdkIsU0FBSSxHQUFZLElBQUksQ0FBQztRQUdyQixlQUFVLEdBQVcsR0FBRyxDQUFDO1FBRXhCLGNBQVMsR0FBUyxJQUFJLFNBQUksRUFBRSxDQUFDO0lBbUV6QyxDQUFDO0lBL0pHLG9CQUFvQjtJQUVwQixJQUFXLFVBQVU7UUFDakIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDO0lBQzVCLENBQUM7SUFFRCxJQUFXLFVBQVUsQ0FBQyxHQUFVO1FBQzVCLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFCLElBQUksQ0FBQyxl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QUUsSUFBSSxFQUFFLFlBQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDO21EQUNoRjtBQTNGdkIsZUFBZTtJQUgzQixPQUFPLENBQUMsaUJBQWlCLENBQUM7SUFDMUIsZ0JBQWdCLENBQUMsV0FBTSxDQUFDO0lBQ3hCLGlCQUFpQixDQUFDLElBQUksQ0FBQztHQUNYLGVBQWUsQ0FnSzNCO0FBaEtZLDBDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgdHdlZW4gfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gJ2NjJztcbmltcG9ydCB7IGVycm9yIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgTWF0ZXJpYWwgfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBDQ0Zsb2F0IH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgU3ByaXRlIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgX2RlY29yYXRvciwgVmVjNCB9IGZyb20gJ2NjJztcbmltcG9ydCB7IEVESVRPUiwgUFJFVklFVyB9IGZyb20gJ2NjL2VudidcbmltcG9ydCB7IEVmZmVjdEJhc2UgfSBmcm9tICcuL0VmZmVjdEJhc2UnO1xuXG5jb25zdCB7IGNjY2xhc3MsIHByb3BlcnR5LCByZXF1aXJlQ29tcG9uZW50LCBleGVjdXRlSW5FZGl0TW9kZSB9ID0gX2RlY29yYXRvcjtcblxuQGNjY2xhc3MoJ0VmZmVjdEZsb3dMaWdodCcpXG5AcmVxdWlyZUNvbXBvbmVudChTcHJpdGUpXG5AZXhlY3V0ZUluRWRpdE1vZGUodHJ1ZSlcbmV4cG9ydCBjbGFzcyBFZmZlY3RGbG93TGlnaHQgZXh0ZW5kcyBFZmZlY3RCYXNlIHtcbiAgICAvLyNyZWdpb24gbGlnaHRDb2xvclxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgdG9vbHRpcDogJ+a1geWFieminOiJsicgfSlcbiAgICBwdWJsaWMgZ2V0IGxpZ2h0Q29sb3IoKTogQ29sb3Ige1xuICAgICAgICByZXR1cm4gdGhpcy5fbGlnaHRDb2xvcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IGxpZ2h0Q29sb3IodmFsOiBDb2xvcikge1xuICAgICAgICB0aGlzLl9saWdodENvbG9yLnNldCh2YWwpO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXNEaXJ0eSgnX2xpZ2h0Q29sb3InKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHRvb2x0aXA6ICfmtYHlhYnpopzoibInLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfbGlnaHRDb2xvcjogQ29sb3IgPSBuZXcgQ29sb3IoMSwgMSwgMSwgMSk7XG4gICAgLy8jZW5kcmVnaW9uXG5cblxuICAgIC8vI3JlZ2lvbiBsaWdodFdpZHRoXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJTZXR0ZXIvR2V0dGVyXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLjEsIDIuMCwgMC4wMDFdLCB0b29sdGlwOiAn5rWB5YWJ5a+s5bqmJyB9KVxuICAgIHB1YmxpYyBnZXQgbGlnaHRXaWR0aCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGlnaHRXaWR0aDtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IGxpZ2h0V2lkdGgodmFsOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fbGlnaHRXaWR0aCA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ19saWdodFByb3AnKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IENDRmxvYXQsIHNsaWRlOiB0cnVlLCByYW5nZTogWzAuMSwgMi4wLCAwLjAwMV0sIHRvb2x0aXA6ICfmtYHlhYnlr6zluqYnLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfbGlnaHRXaWR0aDogbnVtYmVyID0gMC41O1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICAvLyNyZWdpb24gc29mdFxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMC4wLCAxMC4wLCAwLjAwMV0sIHRvb2x0aXA6ICfmn5TpgornqIvluqYnIH0pXG4gICAgcHVibGljIGdldCBzb2Z0KCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zb2Z0O1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgc29mdCh2YWw6IG51bWJlcikge1xuICAgICAgICB0aGlzLl9zb2Z0ID0gdmFsO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXNEaXJ0eSgnX2xpZ2h0UHJvcCcpO1xuICAgIH1cblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiUHJpdmF0ZSBQcm9wc1wiLCBpZDogXCIxXCIgfSwgdHlwZTogQ0NGbG9hdCwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMC4wLCAxMC4wLCAwLjAwMV0sIHRvb2x0aXA6ICfmn5TpgornqIvluqYnLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfc29mdDogbnVtYmVyID0gMC43O1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICAvLyNyZWdpb24gb2Zmc2V0XG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJTZXR0ZXIvR2V0dGVyXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFstMy4wLCAzLjAsIDAuMDAxXSwgdG9vbHRpcDogJ+WBj+enu+mHjycgfSlcbiAgICBwdWJsaWMgZ2V0IG9mZnNldCgpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fb2Zmc2V0O1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgb2Zmc2V0KHZhbDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuX29mZnNldCA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ19saWdodFByb3AnKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IENDRmxvYXQsIHNsaWRlOiB0cnVlLCByYW5nZTogWy0zLjAsIDMuMCwgMC4wMDFdLCB0b29sdGlwOiAn5YGP56e76YePJywgdmlzaWJsZTogdHJ1ZSB9KVxuICAgIHByaXZhdGUgX29mZnNldDogbnVtYmVyID0gLTguMDtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgLy8jcmVnaW9uIHJvdGF0aW9uXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJTZXR0ZXIvR2V0dGVyXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLjAsIDYuMjgsIDAuMV0sIHRvb2x0aXA6ICfmtYHlhYnop5LluqYnIH0pXG4gICAgcHVibGljIGdldCByb3RhdGlvbigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fcm90YXRpb247XG4gICAgfVxuXG4gICAgcHVibGljIHNldCByb3RhdGlvbih2YWw6IG51bWJlcikge1xuICAgICAgICB0aGlzLl9yb3RhdGlvbiA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ19saWdodFByb3AnKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHR5cGU6IENDRmxvYXQsIHNsaWRlOiB0cnVlLCByYW5nZTogWzAuMCwgNi4yOCwgMC4xXSwgdG9vbHRpcDogJ+a1geWFieinkuW6picsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF9yb3RhdGlvbjogbnVtYmVyID0gMi40O1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICBAcHJvcGVydHkoeyBncm91cDp7IG5hbWU6IFwiQW5pbVwiLCBpZDogXCIyXCIgfSwgdG9vbHRpcDogJ+aYr+WQpuiHquWLleaSpeaUvicgfSlcbiAgICBwdWJsaWMgcGxheTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDp7IG5hbWU6IFwiQW5pbVwiLCBpZDogXCIyXCIgfSwgdHlwZTogQ0NGbG9hdCwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMC4wMSwgMTAsIDAuMDFdLCB0b29sdGlwOiAn5oyB57ut5pe26Ze0JyB9KVxuICAgIHB1YmxpYyBkdXJhdGlvbjogbnVtYmVyID0gMS4wO1xuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6eyBuYW1lOiBcIkFuaW1cIiwgaWQ6IFwiMlwiIH0sIHRvb2x0aXA6ICfmmK/lkKblvqrnjq8nIH0pXG4gICAgcHVibGljIGxvb3A6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6eyBuYW1lOiBcIkFuaW1cIiwgaWQ6IFwiMlwiIH0sIHR5cGU6IENDRmxvYXQsIHNsaWRlOiB0cnVlLCByYW5nZTogWzAsIDEwLCAwLjFdLCB0b29sdGlwOiAn5b6q546v6Ze06ZqUJyB9KVxuICAgIHB1YmxpYyBsb29wX2RlbGF5OiBudW1iZXIgPSAwLjA7XG5cbiAgICBwcml2YXRlIHByb3BzVmVjNDogVmVjNCA9IG5ldyBWZWM0KCk7XG5cbiAgICBwcm90ZWN0ZWQgb25Mb2FkKCk6IHZvaWQge1xuICAgICAgICBpZiAoIUVESVRPUiAmJiB0aGlzLnBsYXkpIHtcbiAgICAgICAgICAgIHRoaXMuX29mZnNldCA9IC0zLjA7XG4gICAgICAgIH1cbiAgICAgICAgc3VwZXIub25Mb2FkKCk7XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIF9pbnN0TWF0ZXJpYWwoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmVmZmVjdEFzc2V0KSB7XG4gICAgICAgICAgICBsZXQgbWF0OiBNYXRlcmlhbCA9IG5ldyBNYXRlcmlhbCgpO1xuICAgICAgICAgICAgbWF0LmluaXRpYWxpemUoe1xuICAgICAgICAgICAgICAgIGVmZmVjdEFzc2V0OiB0aGlzLmVmZmVjdEFzc2V0LFxuICAgICAgICAgICAgICAgIGRlZmluZXM6IHsgIH0sXG4gICAgICAgICAgICAgICAgdGVjaG5pcXVlOiB0aGlzLl9pczJEaW4zRCA/IDEgOiAwXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfYmFzZVVWJywgbWF0LnBhc3Nlc1swXS5nZXRIYW5kbGUoJ19iYXNlVVYnKSk7XG4gICAgICAgICAgICB0aGlzLl9zZXRQYXJhbXMoJ19saWdodENvbG9yJywgbWF0LnBhc3Nlc1swXS5nZXRIYW5kbGUoJ19saWdodENvbG9yJykpO1xuICAgICAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfbGlnaHRQcm9wJywgbWF0LnBhc3Nlc1swXS5nZXRIYW5kbGUoJ19saWdodFByb3AnKSk7XG5cbiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZSEuY3VzdG9tTWF0ZXJpYWwgPSBtYXQ7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLnBsYXkpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGxheSgpO1xuICAgICAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVycm9yKCdFZmZlY3RGbG93TGlnaHQ6IGVmZmVjdEFzc2V0IGlzIG51bGwnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBfdXBkYXRlUGFyYW1zKGtleTogc3RyaW5nLCBpZHg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAoa2V5ID09PSAnX2Jhc2VVVicpIHtcbiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZSEubWF0ZXJpYWw/LnBhc3Nlc1swXS5zZXRVbmlmb3JtKGlkeCwgdGhpcy5fZ2V0VVYodGhpcy5fc3ByaXRlIS5zcHJpdGVGcmFtZSEudXYpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdfbGlnaHRDb2xvcicpIHtcbiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZSEubWF0ZXJpYWw/LnBhc3Nlc1swXS5zZXRVbmlmb3JtKGlkeCwgdGhpcy5fbGlnaHRDb2xvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnX2xpZ2h0UHJvcCcpIHtcbiAgICAgICAgICAgIHRoaXMucHJvcHNWZWM0LnggPSB0aGlzLl9saWdodFdpZHRoO1xuICAgICAgICAgICAgdGhpcy5wcm9wc1ZlYzQueSA9IHRoaXMuX3NvZnQ7XG4gICAgICAgICAgICB0aGlzLnByb3BzVmVjNC56ID0gdGhpcy5fb2Zmc2V0O1xuICAgICAgICAgICAgdGhpcy5wcm9wc1ZlYzQudyA9IHRoaXMuX3JvdGF0aW9uO1xuXG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLm1hdGVyaWFsPy5wYXNzZXNbMF0uc2V0VW5pZm9ybShpZHgsIHRoaXMucHJvcHNWZWM0KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3BsYXkoKTogdm9pZCB7XG4gICAgICAgIGxldCB0d2VlblRhcmdldCA9IHsgb2Zmc2V0OiAtMy4wIH07IC8vIFdyYXAgdGhlIG51bWJlciBpbiBhbiBvYmplY3RcbiAgICAgICAgdHdlZW4odHdlZW5UYXJnZXQpLnRvKHRoaXMuZHVyYXRpb24sIHsgb2Zmc2V0OiAzLjAgfSwge1xuICAgICAgICAgICAgb25VcGRhdGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLm9mZnNldCA9IHR3ZWVuVGFyZ2V0Lm9mZnNldDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubG9vcCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlT25jZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIHRoaXMubG9vcF9kZWxheSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KS5zdGFydCgpO1xuICAgIH1cbn1cblxuXG4iXX0=