"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EffectColor = exports.BlurMode = exports.ColorMode = exports.ToneMode = void 0;
const cc_1 = require("cc");
const cc_2 = require("cc");
const cc_3 = require("cc");
const cc_4 = require("cc");
const cc_5 = require("cc");
const cc_6 = require("cc");
const cc_7 = require("cc");
const EffectBase_1 = require("./EffectBase");
const { ccclass, property } = cc_2._decorator;
var ToneMode;
(function (ToneMode) {
    ToneMode[ToneMode["GRAY"] = 0] = "GRAY";
    ToneMode[ToneMode["NEGA"] = 1] = "NEGA";
    ToneMode[ToneMode["SEPIA"] = 2] = "SEPIA";
    ToneMode[ToneMode["NORMAL"] = 3] = "NORMAL";
})(ToneMode = exports.ToneMode || (exports.ToneMode = {}));
var ColorMode;
(function (ColorMode) {
    ColorMode[ColorMode["ADD"] = 0] = "ADD";
    ColorMode[ColorMode["SUB"] = 1] = "SUB";
    ColorMode[ColorMode["FILL"] = 2] = "FILL";
    ColorMode[ColorMode["MULT"] = 3] = "MULT";
})(ColorMode = exports.ColorMode || (exports.ColorMode = {}));
var BlurMode;
(function (BlurMode) {
    BlurMode[BlurMode["NONE"] = 0] = "NONE";
    BlurMode[BlurMode["GAUSSIAN"] = 1] = "GAUSSIAN";
})(BlurMode = exports.BlurMode || (exports.BlurMode = {}));
let EffectColor = class EffectColor extends EffectBase_1.EffectBase {
    constructor() {
        super(...arguments);
        this._toneMode = ToneMode.NORMAL;
        this._toneFactor = 1.0;
        this._colorMode = ColorMode.MULT;
        this._colorFactor = 1.0;
        this._blurMode = BlurMode.NONE;
        this._blurFactor = 1.0;
        //#endregion
        this._blurTextureSize = new cc_5.Vec2(100, 100);
        this._contentSize = new cc_6.math.Size(100, 100);
        this._define_macro = {
            USE_COLOR_TONE_TRANSFORM: true,
            USE_NORMALIZE_UV: true,
            USE_BLUR: false,
            IS_GRAY: false,
            IS_NEGA: false,
            IS_SEPIA: false,
            IS_ADD: false,
            IS_SUB: false,
            IS_FILL: false,
            IS_MULT: false
        };
    }
    //#region toneMode
    get toneMode() {
        return this._toneMode;
    }
    set toneMode(val) {
        this._toneMode = val;
        this._setParamsDirty('_toneMode');
    }
    //#endregion
    //#region toneFactor
    get toneFactor() {
        return this._toneFactor;
    }
    set toneFactor(val) {
        this._toneFactor = val;
        this._setParamsDirty('_toneFactor');
    }
    //#endregion
    //#region colorMode
    get colorMode() {
        return this._colorMode;
    }
    set colorMode(val) {
        this._colorMode = val;
        this._setParamsDirty('_colorMode');
    }
    //#endregion
    //#region colorFactor
    get colorFactor() {
        return this._colorFactor;
    }
    set colorFactor(val) {
        this._colorFactor = val;
        this._setParamsDirty('_colorFactor');
    }
    //#endregion
    //#region blurMode
    get blurMode() {
        return this._blurMode;
    }
    set blurMode(val) {
        this._blurMode = val;
        this._setParamsDirty('_blurMode');
    }
    //#endregion
    //#region blurFactor
    get blurFactor() {
        return this._blurFactor;
    }
    set blurFactor(val) {
        this._blurFactor = val;
        this._setParamsDirty('_blurFactor');
    }
    _instMaterial() {
        this._contentSize = this._sprite.getComponent(cc_7.UITransform).contentSize;
        if (this.effectAsset) {
            switch (this._toneMode) {
                case ToneMode.GRAY:
                    this._define_macro.IS_GRAY = true;
                    break;
                case ToneMode.NEGA:
                    this._define_macro.IS_NEGA = true;
                    break;
                case ToneMode.SEPIA:
                    this._define_macro.IS_SEPIA = true;
                    break;
                case ToneMode.NORMAL:
                    break;
            }
            ;
            switch (this._colorMode) {
                case ColorMode.ADD:
                    this._define_macro.IS_ADD = true;
                    break;
                case ColorMode.SUB:
                    this._define_macro.IS_SUB = true;
                    break;
                case ColorMode.FILL:
                    this._define_macro.IS_FILL = true;
                    break;
                case ColorMode.MULT:
                    this._define_macro.IS_MULT = true;
                    break;
            }
            switch (this._blurMode) {
                case BlurMode.NONE:
                    this._define_macro.USE_BLUR = false;
                    break;
                case BlurMode.GAUSSIAN:
                    this._define_macro.USE_BLUR = true;
                    break;
            }
            this._reflashMaterial();
        }
        else {
            cc_3.error('EffectColor._instMaterial: effectAsset is null');
        }
    }
    _reflashMaterial() {
        let mat = new cc_1.Material();
        mat.initialize({
            effectAsset: this.effectAsset,
            defines: this._define_macro,
            technique: this._is2Din3D ? 1 : 0
        });
        this._setParams('_toneMode', -1);
        this._setParams('_colorMode', -1);
        this._setParams('_blurMode', -1);
        this._setParams('_baseUV', mat.passes[0].getHandle('baseUV'));
        this._setParams('_toneFactor', mat.passes[0].getHandle('toneFactor'));
        this._setParams('_colorFactor', mat.passes[0].getHandle('colorFactor'));
        this._setParams('_blurTextureSize', mat.passes[0].getHandle('blurTextureSize'));
        this._setParams('_blurFactor', mat.passes[0].getHandle('blurFactor'));
        this._sprite.customMaterial = mat;
    }
    _updateParams(key, idx) {
        var _a, _b, _c, _d, _e;
        if (key === '_baseUV') {
            (_a = this._sprite.material) === null || _a === void 0 ? void 0 : _a.passes[0].setUniform(idx, this._getUV(this._sprite.spriteFrame.uv));
        }
        else if (key === '_toneFactor') {
            (_b = this._sprite.material) === null || _b === void 0 ? void 0 : _b.passes[0].setUniform(idx, this._toneFactor);
        }
        else if (key === '_colorFactor') {
            (_c = this._sprite.material) === null || _c === void 0 ? void 0 : _c.passes[0].setUniform(idx, this._colorFactor);
        }
        else if (key === '_blurTextureSize') {
            const baseUV = this._getUV(this._sprite.spriteFrame.uv);
            if (this._sprite.spriteFrame) {
                this._blurTextureSize.x = Math.floor(this._sprite.spriteFrame.width * baseUV.z);
                this._blurTextureSize.y = Math.floor(this._sprite.spriteFrame.height * baseUV.w);
            }
            else {
                this._blurTextureSize.x = this._contentSize.width;
                this._blurTextureSize.y = this._contentSize.height;
            }
            (_d = this._sprite.material) === null || _d === void 0 ? void 0 : _d.passes[0].setUniform(idx, this._blurTextureSize);
        }
        else if (key === '_blurFactor') {
            (_e = this._sprite.material) === null || _e === void 0 ? void 0 : _e.passes[0].setUniform(idx, cc_6.math.lerp(0.0, 1.0, this._blurFactor));
        }
        else if (key === '_toneMode') {
            this._define_macro.IS_GRAY = false;
            this._define_macro.IS_NEGA = false;
            this._define_macro.IS_SEPIA = false;
            switch (this._toneMode) {
                case ToneMode.GRAY:
                    this._define_macro.IS_GRAY = true;
                    break;
                case ToneMode.NEGA:
                    this._define_macro.IS_NEGA = true;
                    break;
                case ToneMode.SEPIA:
                    this._define_macro.IS_SEPIA = true;
                    break;
                case ToneMode.NORMAL:
                    break;
            }
            ;
            this._reflashMaterial();
        }
        else if (key === '_colorMode') {
            this._define_macro.IS_ADD = false;
            this._define_macro.IS_SUB = false;
            this._define_macro.IS_FILL = false;
            this._define_macro.IS_MULT = false;
            switch (this._colorMode) {
                case ColorMode.ADD:
                    this._define_macro.IS_ADD = true;
                    break;
                case ColorMode.SUB:
                    this._define_macro.IS_SUB = true;
                    break;
                case ColorMode.FILL:
                    this._define_macro.IS_FILL = true;
                    break;
                case ColorMode.MULT:
                    this._define_macro.IS_MULT = true;
                    break;
            }
            this._reflashMaterial();
        }
        else if (key === '_blurMode') {
            switch (this._blurMode) {
                case BlurMode.NONE:
                    this._define_macro.USE_BLUR = false;
                    break;
                case BlurMode.GAUSSIAN:
                    this._define_macro.USE_BLUR = true;
                    break;
            }
            this._reflashMaterial();
        }
    }
    _is2Din3DChanged(enable) {
        this._reflashMaterial();
    }
};
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, type: cc_4.Enum(ToneMode), tooltip: "色調模式" })
], EffectColor.prototype, "toneMode", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_4.Enum(ToneMode), tooltip: "色調模式", visible: true })
], EffectColor.prototype, "_toneMode", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "色調程度" })
], EffectColor.prototype, "toneFactor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "色調程度", visible: true })
], EffectColor.prototype, "_toneFactor", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, type: cc_4.Enum(ColorMode), tooltip: "顏色模式" })
], EffectColor.prototype, "colorMode", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_4.Enum(ColorMode), tooltip: "顏色模式", visible: true })
], EffectColor.prototype, "_colorMode", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "顏色程度" })
], EffectColor.prototype, "colorFactor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "顏色程度", visible: true })
], EffectColor.prototype, "_colorFactor", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, type: cc_4.Enum(BlurMode), tooltip: "模糊模式" })
], EffectColor.prototype, "blurMode", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, type: cc_4.Enum(BlurMode), tooltip: "模糊模式", visible: true })
], EffectColor.prototype, "_blurMode", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0.0, 1.0, 0.01], tooltip: "模糊程度" })
], EffectColor.prototype, "blurFactor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0.0, 1.0, 0.01], tooltip: "模糊程度", visible: true })
], EffectColor.prototype, "_blurFactor", void 0);
EffectColor = __decorate([
    ccclass('EffectColor')
], EffectColor);
exports.EffectColor = EffectColor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWZmZWN0Q29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2Uvc2NyaXB0L0VmZmVjdENvbG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLDJCQUFtQztBQUNuQywyQkFBZ0M7QUFDaEMsMkJBQTJCO0FBQzNCLDJCQUEwQjtBQUMxQiwyQkFBMEI7QUFDMUIsMkJBQTBCO0FBQzFCLDJCQUFpQztBQUNqQyw2Q0FBMEM7QUFFMUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsR0FBRyxlQUFVLENBQUM7QUFFekMsSUFBWSxRQUtYO0FBTEQsV0FBWSxRQUFRO0lBQ2hCLHVDQUFJLENBQUE7SUFDSix1Q0FBSSxDQUFBO0lBQ0oseUNBQUssQ0FBQTtJQUNMLDJDQUFNLENBQUE7QUFDVixDQUFDLEVBTFcsUUFBUSxHQUFSLGdCQUFRLEtBQVIsZ0JBQVEsUUFLbkI7QUFFRCxJQUFZLFNBS1g7QUFMRCxXQUFZLFNBQVM7SUFDakIsdUNBQUcsQ0FBQTtJQUNILHVDQUFHLENBQUE7SUFDSCx5Q0FBSSxDQUFBO0lBQ0oseUNBQUksQ0FBQTtBQUNSLENBQUMsRUFMVyxTQUFTLEdBQVQsaUJBQVMsS0FBVCxpQkFBUyxRQUtwQjtBQUVELElBQVksUUFHWDtBQUhELFdBQVksUUFBUTtJQUNoQix1Q0FBSSxDQUFBO0lBQ0osK0NBQVEsQ0FBQTtBQUNaLENBQUMsRUFIVyxRQUFRLEdBQVIsZ0JBQVEsS0FBUixnQkFBUSxRQUduQjtBQUdELElBQWEsV0FBVyxHQUF4QixNQUFhLFdBQVksU0FBUSx1QkFBVTtJQUEzQzs7UUFhWSxjQUFTLEdBQWEsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQWdCdEMsZ0JBQVcsR0FBVyxHQUFHLENBQUM7UUFnQjFCLGVBQVUsR0FBYyxTQUFTLENBQUMsSUFBSSxDQUFDO1FBZ0J2QyxpQkFBWSxHQUFXLEdBQUcsQ0FBQztRQWdCM0IsY0FBUyxHQUFhLFFBQVEsQ0FBQyxJQUFJLENBQUM7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QUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQzsyQ0FHOUY7QUFRRDtJQURDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7OENBQ2xFO0FBTTVDO0lBREMsUUFBUSxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQzs2Q0FHOUc7QUFRRDtJQURDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztnREFDNUY7QUE3RnpCLFdBQVc7SUFEdkIsT0FBTyxDQUFDLGFBQWEsQ0FBQztHQUNWLFdBQVcsQ0E4UXZCO0FBOVFZLGtDQUFXIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTWF0ZXJpYWwsIGxvZyB9IGZyb20gJ2NjJztcbmltcG9ydCB7IF9kZWNvcmF0b3IgfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBlcnJvciB9IGZyb20gJ2NjJztcbmltcG9ydCB7IEVudW0gfSBmcm9tICdjYyc7XG5pbXBvcnQgeyBWZWMyIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgbWF0aCB9IGZyb20gJ2NjJztcbmltcG9ydCB7IFVJVHJhbnNmb3JtIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgRWZmZWN0QmFzZSB9IGZyb20gJy4vRWZmZWN0QmFzZSc7XG5cbmNvbnN0IHsgY2NjbGFzcywgcHJvcGVydHkgfSA9IF9kZWNvcmF0b3I7XG5cbmV4cG9ydCBlbnVtIFRvbmVNb2RlIHtcbiAgICBHUkFZLFxuICAgIE5FR0EsXG4gICAgU0VQSUEsXG4gICAgTk9STUFMXG59XG5cbmV4cG9ydCBlbnVtIENvbG9yTW9kZSB7XG4gICAgQURELFxuICAgIFNVQixcbiAgICBGSUxMLFxuICAgIE1VTFRcbn1cblxuZXhwb3J0IGVudW0gQmx1ck1vZGUge1xuICAgIE5PTkUsXG4gICAgR0FVU1NJQU5cbn1cblxuQGNjY2xhc3MoJ0VmZmVjdENvbG9yJylcbmV4cG9ydCBjbGFzcyBFZmZlY3RDb2xvciBleHRlbmRzIEVmZmVjdEJhc2Uge1xuICAgIC8vI3JlZ2lvbiB0b25lTW9kZVxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgdHlwZTogRW51bShUb25lTW9kZSksIHRvb2x0aXA6IFwi6Imy6Kq/5qih5byPXCIgfSlcbiAgICBwdWJsaWMgZ2V0IHRvbmVNb2RlKCk6IFRvbmVNb2RlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RvbmVNb2RlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgdG9uZU1vZGUodmFsOiBUb25lTW9kZSkge1xuICAgICAgICB0aGlzLl90b25lTW9kZSA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ190b25lTW9kZScpO1xuICAgIH1cblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiUHJpdmF0ZSBQcm9wc1wiLCBpZDogXCIxXCIgfSwgdHlwZTogRW51bShUb25lTW9kZSksIHRvb2x0aXA6IFwi6Imy6Kq/5qih5byPXCIsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF90b25lTW9kZTogVG9uZU1vZGUgPSBUb25lTW9kZS5OT1JNQUw7XG4gICAgLy8jZW5kcmVnaW9uXG5cblxuICAgIC8vI3JlZ2lvbiB0b25lRmFjdG9yXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJTZXR0ZXIvR2V0dGVyXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLCAxLCAwLjAxXSwgdG9vbHRpcDogXCLoibLoqr/nqIvluqZcIiB9KVxuICAgIHB1YmxpYyBnZXQgdG9uZUZhY3RvcigpOiBudW1iZXIge1xuICAgICAgICByZXR1cm4gdGhpcy5fdG9uZUZhY3RvcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IHRvbmVGYWN0b3IodmFsOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fdG9uZUZhY3RvciA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ190b25lRmFjdG9yJyk7XG4gICAgfVxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJQcml2YXRlIFByb3BzXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLCAxLCAwLjAxXSwgdG9vbHRpcDogXCLoibLoqr/nqIvluqZcIiwgdmlzaWJsZTogdHJ1ZSB9KVxuICAgIHByaXZhdGUgX3RvbmVGYWN0b3I6IG51bWJlciA9IDEuMDtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgLy8jcmVnaW9uIGNvbG9yTW9kZVxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgdHlwZTogRW51bShDb2xvck1vZGUpLCB0b29sdGlwOiBcIumhj+iJsuaooeW8j1wiIH0pXG4gICAgcHVibGljIGdldCBjb2xvck1vZGUoKTogQ29sb3JNb2RlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbG9yTW9kZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IGNvbG9yTW9kZSh2YWw6IENvbG9yTW9kZSkge1xuICAgICAgICB0aGlzLl9jb2xvck1vZGUgPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfY29sb3JNb2RlJyk7XG4gICAgfVxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJQcml2YXRlIFByb3BzXCIsIGlkOiBcIjFcIiB9LCB0eXBlOiBFbnVtKENvbG9yTW9kZSksIHRvb2x0aXA6IFwi6aGP6Imy5qih5byPXCIsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF9jb2xvck1vZGU6IENvbG9yTW9kZSA9IENvbG9yTW9kZS5NVUxUO1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICAvLyNyZWdpb24gY29sb3JGYWN0b3JcbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlNldHRlci9HZXR0ZXJcIiwgaWQ6IFwiMVwiIH0sIHNsaWRlOiB0cnVlLCByYW5nZTogWzAsIDEsIDAuMDFdLCB0b29sdGlwOiBcIumhj+iJsueoi+W6plwifSlcbiAgICBwdWJsaWMgZ2V0IGNvbG9yRmFjdG9yKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb2xvckZhY3RvcjtcbiAgICB9XG5cbiAgICBwdWJsaWMgc2V0IGNvbG9yRmFjdG9yKHZhbDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuX2NvbG9yRmFjdG9yID0gdmFsO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXNEaXJ0eSgnX2NvbG9yRmFjdG9yJyk7XG4gICAgfVxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJQcml2YXRlIFByb3BzXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLCAxLCAwLjAxXSwgdG9vbHRpcDogXCLpoY/oibLnqIvluqZcIiwgdmlzaWJsZTogdHJ1ZSB9KVxuICAgIHByaXZhdGUgX2NvbG9yRmFjdG9yOiBudW1iZXIgPSAxLjA7XG4gICAgLy8jZW5kcmVnaW9uXG5cblxuICAgIC8vI3JlZ2lvbiBibHVyTW9kZVxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgdHlwZTogRW51bShCbHVyTW9kZSksIHRvb2x0aXA6IFwi5qih57OK5qih5byPXCIgfSlcbiAgICBwdWJsaWMgZ2V0IGJsdXJNb2RlKCk6IEJsdXJNb2RlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2JsdXJNb2RlO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgYmx1ck1vZGUodmFsOiBCbHVyTW9kZSkge1xuICAgICAgICB0aGlzLl9ibHVyTW9kZSA9IHZhbDtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zRGlydHkoJ19ibHVyTW9kZScpO1xuICAgIH1cblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiUHJpdmF0ZSBQcm9wc1wiLCBpZDogXCIxXCIgfSwgdHlwZTogRW51bShCbHVyTW9kZSksIHRvb2x0aXA6IFwi5qih57OK5qih5byPXCIsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF9ibHVyTW9kZTogQmx1ck1vZGUgPSBCbHVyTW9kZS5OT05FO1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICAvLyNyZWdpb24gYmx1ckZhY3RvclxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMC4wLCAxLjAsIDAuMDFdLCB0b29sdGlwOiBcIuaooeeziueoi+W6plwiIH0pXG4gICAgcHVibGljIGdldCBibHVyRmFjdG9yKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ibHVyRmFjdG9yO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgYmx1ckZhY3Rvcih2YWw6IG51bWJlcikge1xuICAgICAgICB0aGlzLl9ibHVyRmFjdG9yID0gdmFsO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXNEaXJ0eSgnX2JsdXJGYWN0b3InKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHNsaWRlOiB0cnVlLCByYW5nZTogWzAuMCwgMS4wLCAwLjAxXSwgdG9vbHRpcDogXCLmqKHns4rnqIvluqZcIiwgdmlzaWJsZTogdHJ1ZSB9KVxuICAgIHByaXZhdGUgX2JsdXJGYWN0b3I6IG51bWJlciA9IDEuMDtcbiAgICAvLyNlbmRyZWdpb25cblxuICAgIHByaXZhdGUgX2JsdXJUZXh0dXJlU2l6ZTogVmVjMiA9IG5ldyBWZWMyKDEwMCwgMTAwKTtcbiAgICBwcml2YXRlIF9jb250ZW50U2l6ZTogbWF0aC5TaXplID0gbmV3IG1hdGguU2l6ZSgxMDAsIDEwMCk7XG4gICAgXG4gICAgcHJpdmF0ZSBfZGVmaW5lX21hY3JvID0ge1xuICAgICAgICBVU0VfQ09MT1JfVE9ORV9UUkFOU0ZPUk06IHRydWUsXG4gICAgICAgIFVTRV9OT1JNQUxJWkVfVVY6IHRydWUsXG4gICAgICAgIFVTRV9CTFVSOiBmYWxzZSxcblxuICAgICAgICBJU19HUkFZOiBmYWxzZSxcbiAgICAgICAgSVNfTkVHQTogZmFsc2UsXG4gICAgICAgIElTX1NFUElBOiBmYWxzZSxcbiAgICAgICAgSVNfQUREOiBmYWxzZSxcbiAgICAgICAgSVNfU1VCOiBmYWxzZSxcbiAgICAgICAgSVNfRklMTDogZmFsc2UsXG4gICAgICAgIElTX01VTFQ6IGZhbHNlXG4gICAgfTtcblxuICAgIHByb3RlY3RlZCBfaW5zdE1hdGVyaWFsKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9jb250ZW50U2l6ZSA9IHRoaXMuX3Nwcml0ZSEuZ2V0Q29tcG9uZW50KFVJVHJhbnNmb3JtKSEuY29udGVudFNpemU7XG5cbiAgICAgICAgaWYgKHRoaXMuZWZmZWN0QXNzZXQpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fdG9uZU1vZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFRvbmVNb2RlLkdSQVk6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19HUkFZID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUb25lTW9kZS5ORUdBOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfTkVHQSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVG9uZU1vZGUuU0VQSUE6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19TRVBJQSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVG9uZU1vZGUuTk9STUFMOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fY29sb3JNb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBDb2xvck1vZGUuQUREOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfQUREID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBDb2xvck1vZGUuU1VCOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfU1VCID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBDb2xvck1vZGUuRklMTDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX0ZJTEwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIENvbG9yTW9kZS5NVUxUOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfTVVMVCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX2JsdXJNb2RlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBCbHVyTW9kZS5OT05FOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uVVNFX0JMVVIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBCbHVyTW9kZS5HQVVTU0lBTjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLlVTRV9CTFVSID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3JlZmxhc2hNYXRlcmlhbCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXJyb3IoJ0VmZmVjdENvbG9yLl9pbnN0TWF0ZXJpYWw6IGVmZmVjdEFzc2V0IGlzIG51bGwnKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgX3JlZmxhc2hNYXRlcmlhbCgpOiB2b2lkIHtcbiAgICAgICAgbGV0IG1hdDogTWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoKTtcbiAgICAgICAgbWF0LmluaXRpYWxpemUoe1xuICAgICAgICAgICAgZWZmZWN0QXNzZXQ6IHRoaXMuZWZmZWN0QXNzZXQsXG4gICAgICAgICAgICBkZWZpbmVzOiB0aGlzLl9kZWZpbmVfbWFjcm8sXG4gICAgICAgICAgICB0ZWNobmlxdWU6IHRoaXMuX2lzMkRpbjNEID8gMSA6IDBcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfdG9uZU1vZGUnLCAtMSk7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2NvbG9yTW9kZScsIC0xKTtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfYmx1ck1vZGUnLCAtMSk7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2Jhc2VVVicsIG1hdC5wYXNzZXNbMF0uZ2V0SGFuZGxlKCdiYXNlVVYnKSk7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtcygnX3RvbmVGYWN0b3InLCBtYXQucGFzc2VzWzBdLmdldEhhbmRsZSgndG9uZUZhY3RvcicpKTtcbiAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfY29sb3JGYWN0b3InLCBtYXQucGFzc2VzWzBdLmdldEhhbmRsZSgnY29sb3JGYWN0b3InKSk7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2JsdXJUZXh0dXJlU2l6ZScsIG1hdC5wYXNzZXNbMF0uZ2V0SGFuZGxlKCdibHVyVGV4dHVyZVNpemUnKSk7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2JsdXJGYWN0b3InLCBtYXQucGFzc2VzWzBdLmdldEhhbmRsZSgnYmx1ckZhY3RvcicpKTtcblxuICAgICAgICB0aGlzLl9zcHJpdGUhLmN1c3RvbU1hdGVyaWFsID0gbWF0O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfdXBkYXRlUGFyYW1zKGtleTogc3RyaW5nLCBpZHg6IG51bWJlcik6IHZvaWQge1xuICAgICAgICBpZiAoa2V5ID09PSAnX2Jhc2VVVicpIHtcbiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZSEubWF0ZXJpYWw/LnBhc3Nlc1swXS5zZXRVbmlmb3JtKGlkeCwgdGhpcy5fZ2V0VVYodGhpcy5fc3ByaXRlIS5zcHJpdGVGcmFtZSEudXYpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdfdG9uZUZhY3RvcicpIHtcbiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZSEubWF0ZXJpYWw/LnBhc3Nlc1swXS5zZXRVbmlmb3JtKGlkeCwgdGhpcy5fdG9uZUZhY3Rvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnX2NvbG9yRmFjdG9yJykge1xuICAgICAgICAgICAgdGhpcy5fc3ByaXRlIS5tYXRlcmlhbD8ucGFzc2VzWzBdLnNldFVuaWZvcm0oaWR4LCB0aGlzLl9jb2xvckZhY3Rvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnX2JsdXJUZXh0dXJlU2l6ZScpIHtcbiAgICAgICAgICAgIGNvbnN0IGJhc2VVViA9IHRoaXMuX2dldFVWKHRoaXMuX3Nwcml0ZSEuc3ByaXRlRnJhbWUhLnV2KTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuX3Nwcml0ZSEuc3ByaXRlRnJhbWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9ibHVyVGV4dHVyZVNpemUueCA9IE1hdGguZmxvb3IodGhpcy5fc3ByaXRlIS5zcHJpdGVGcmFtZS53aWR0aCAqIGJhc2VVVi56KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9ibHVyVGV4dHVyZVNpemUueSA9IE1hdGguZmxvb3IodGhpcy5fc3ByaXRlIS5zcHJpdGVGcmFtZS5oZWlnaHQgKiBiYXNlVVYudyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9ibHVyVGV4dHVyZVNpemUueCA9IHRoaXMuX2NvbnRlbnRTaXplLndpZHRoO1xuICAgICAgICAgICAgICAgIHRoaXMuX2JsdXJUZXh0dXJlU2l6ZS55ID0gdGhpcy5fY29udGVudFNpemUuaGVpZ2h0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLm1hdGVyaWFsPy5wYXNzZXNbMF0uc2V0VW5pZm9ybShpZHgsIHRoaXMuX2JsdXJUZXh0dXJlU2l6ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnX2JsdXJGYWN0b3InKSB7XG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLm1hdGVyaWFsPy5wYXNzZXNbMF0uc2V0VW5pZm9ybShpZHgsIG1hdGgubGVycCgwLjAsIDEuMCwgdGhpcy5fYmx1ckZhY3RvcikpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ190b25lTW9kZScpIHtcbiAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19HUkFZID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfTkVHQSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX1NFUElBID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fdG9uZU1vZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFRvbmVNb2RlLkdSQVk6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19HUkFZID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBUb25lTW9kZS5ORUdBOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfTkVHQSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVG9uZU1vZGUuU0VQSUE6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19TRVBJQSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgVG9uZU1vZGUuTk9STUFMOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRoaXMuX3JlZmxhc2hNYXRlcmlhbCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ19jb2xvck1vZGUnKSB7XG4gICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfQUREID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfU1VCID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfRklMTCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fZGVmaW5lX21hY3JvLklTX01VTFQgPSBmYWxzZTtcblxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9jb2xvck1vZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIENvbG9yTW9kZS5BREQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19BREQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIENvbG9yTW9kZS5TVUI6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19TVUIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIENvbG9yTW9kZS5GSUxMOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uSVNfRklMTCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgQ29sb3JNb2RlLk1VTFQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5JU19NVUxUID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3JlZmxhc2hNYXRlcmlhbCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ19ibHVyTW9kZScpIHtcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5fYmx1ck1vZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIEJsdXJNb2RlLk5PTkU6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RlZmluZV9tYWNyby5VU0VfQkxVUiA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIEJsdXJNb2RlLkdBVVNTSUFOOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9kZWZpbmVfbWFjcm8uVVNFX0JMVVIgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fcmVmbGFzaE1hdGVyaWFsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2lzMkRpbjNEQ2hhbmdlZChlbmFibGU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5fcmVmbGFzaE1hdGVyaWFsKCk7XG4gICAgfVxufVxuXG5cbiJdfQ==