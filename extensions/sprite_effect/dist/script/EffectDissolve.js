"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.EffectDissolve = void 0;
const cc_1 = require("cc");
const EffectBase_1 = require("./EffectBase");
const cc_2 = require("cc");
const cc_3 = require("cc");
const cc_4 = require("cc");
const cc_5 = require("cc");
const cc_6 = require("cc");
const { ccclass, property } = cc_1._decorator;
let EffectDissolve = class EffectDissolve extends EffectBase_1.EffectBase {
    constructor() {
        super(...arguments);
        this.noiseTexture = null;
        this._dissolveColor = new cc_2.Color(0, 0, 0, 1);
        this._factor = 0.5;
        this._softness = 0.1;
        this._width = 0.1;
        //#endregion
        this.play = true;
        this.duration = 1.0;
        this.loop = true;
        this.loop_delay = 0.0;
    }
    //#region dissolveColor
    get dissolveColor() {
        return this._dissolveColor;
    }
    set dissolveColor(val) {
        this._dissolveColor.set(val);
        this._setParamsDirty('_dissolveColor');
    }
    //#endregion
    //#region effectFactor
    get factor() {
        return this._factor;
    }
    set factor(val) {
        this._factor = val;
        this._setParamsDirty('_factor');
    }
    //#endregion
    //#region softness
    get softness() {
        return this._softness;
    }
    set softness(val) {
        this._softness = val;
        this._setParamsDirty('_softness');
    }
    //#endregion
    //#region width
    get width() {
        return this._width;
    }
    set width(val) {
        this._width = val;
        this._setParamsDirty('_width');
    }
    _instMaterial() {
        if (this.effectAsset) {
            let mat = new cc_4.Material();
            mat.initialize({
                effectAsset: this.effectAsset,
                technique: this._is2Din3D ? 1 : 0
            });
            mat.setProperty('_noisetex', this.noiseTexture);
            this._setParams('_dissolveColor', mat.passes[0].getHandle('_dissolveColor'));
            this._setParams('_factor', mat.passes[0].getHandle('_factor'));
            this._setParams('_softness', mat.passes[0].getHandle('_softness'));
            this._setParams('_width', mat.passes[0].getHandle('_width'));
            this._sprite.customMaterial = mat;
            if (this.play) {
                setTimeout(() => {
                    this._play();
                }, 10);
            }
        }
    }
    _updateParams(key, idx) {
        var _a, _b, _c, _d;
        if (key === '_dissolveColor') {
            (_a = this._sprite.material) === null || _a === void 0 ? void 0 : _a.passes[0].setUniform(idx, this._dissolveColor);
        }
        else if (key === '_factor') {
            (_b = this._sprite.material) === null || _b === void 0 ? void 0 : _b.passes[0].setUniform(idx, this._factor);
        }
        else if (key === '_softness') {
            (_c = this._sprite.material) === null || _c === void 0 ? void 0 : _c.passes[0].setUniform(idx, this._softness);
        }
        else if (key === '_width') {
            (_d = this._sprite.material) === null || _d === void 0 ? void 0 : _d.passes[0].setUniform(idx, this._width);
        }
    }
    _play() {
        let tweenTarget = { factor: 0.0 };
        cc_6.tween(tweenTarget).to(this.duration, { factor: 1.0 }, {
            onUpdate: () => {
                this.factor = tweenTarget.factor;
            },
            onComplete: () => {
                if (this.loop) {
                    this.scheduleOnce(() => {
                        this._play();
                    }, this.loop_delay);
                }
            }
        }).start();
    }
};
__decorate([
    property({ type: cc_3.Texture2D, tooltip: "指定噪聲貼圖" })
], EffectDissolve.prototype, "noiseTexture", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, tooltip: "溶解顏色" })
], EffectDissolve.prototype, "dissolveColor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, tooltip: "溶解顏色", visible: true })
], EffectDissolve.prototype, "_dissolveColor", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "溶解程度" })
], EffectDissolve.prototype, "factor", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "溶解程度", visible: true })
], EffectDissolve.prototype, "_factor", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "柔邊程度" })
], EffectDissolve.prototype, "softness", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "柔邊程度", visible: true })
], EffectDissolve.prototype, "_softness", void 0);
__decorate([
    property({ group: { name: "Setter/Getter", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "溶解寬度" })
], EffectDissolve.prototype, "width", null);
__decorate([
    property({ group: { name: "Private Props", id: "1" }, slide: true, range: [0, 1, 0.01], tooltip: "溶解寬度", visible: true })
], EffectDissolve.prototype, "_width", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, tooltip: '是否自動撥放' })
], EffectDissolve.prototype, "play", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, type: cc_5.CCFloat, slide: true, range: [0.01, 10, 0.01], tooltip: '持续时间' })
], EffectDissolve.prototype, "duration", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, tooltip: '是否循环' })
], EffectDissolve.prototype, "loop", void 0);
__decorate([
    property({ group: { name: "Anim", id: "2" }, type: cc_5.CCFloat, slide: true, range: [0, 10, 0.1], tooltip: '循环间隔' })
], EffectDissolve.prototype, "loop_delay", void 0);
EffectDissolve = __decorate([
    ccclass('EffectDissolve')
], EffectDissolve);
exports.EffectDissolve = EffectDissolve;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRWZmZWN0RGlzc29sdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2Uvc2NyaXB0L0VmZmVjdERpc3NvbHZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLDJCQUFnQztBQUNoQyw2Q0FBMEM7QUFDMUMsMkJBQTJCO0FBQzNCLDJCQUErQjtBQUMvQiwyQkFBOEI7QUFDOUIsMkJBQTZCO0FBQzdCLDJCQUEyQjtBQUUzQixNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxHQUFHLGVBQVUsQ0FBQztBQUd6QyxJQUFhLGNBQWMsR0FBM0IsTUFBYSxjQUFlLFNBQVEsdUJBQVU7SUFBOUM7O1FBRVcsaUJBQVksR0FBcUIsSUFBSSxDQUFDO1FBY3JDLG1CQUFjLEdBQVUsSUFBSSxVQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFnQjlDLFlBQU8sR0FBVyxHQUFHLENBQUM7UUFnQnRCLGNBQVMsR0FBVyxHQUFHLENBQUM7UUFnQnhCLFdBQU0sR0FBVyxHQUFHLENBQUM7UUFDN0IsWUFBWTtRQUlMLFNBQUksR0FBWSxJQUFJLENBQUM7UUFHckIsYUFBUSxHQUFXLEdBQUcsQ0FBQztRQUd2QixTQUFJLEdBQVksSUFBSSxDQUFDO1FBR3JCLGVBQVUsR0FBVyxHQUFHLENBQUM7SUEwRHBDLENBQUM7SUFwSUcsdUJBQXVCO0lBRXZCLElBQVcsYUFBYTtRQUNwQixPQUFPLElBQUksQ0FBQyxjQUFjLENBQUM7SUFDL0IsQ0FBQztJQUVELElBQVcsYUFBYSxDQUFDLEdBQVU7UUFDL0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFJRCxZQUFZO0lBR1osc0JBQXNCO0lBRXRCLElBQVcsTUFBTTtRQUNiLE9BQU8sSUFBSSxDQUFD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LEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDO3NEQUNsQztBQU10RDtJQURDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUM7NENBRzFHO0FBUUQ7SUFEQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7K0NBQzVGO0FBTTlCO0lBREMsUUFBUSxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQzs4Q0FHMUc7QUFRRDtJQURDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztpREFDMUY7QUFNaEM7SUFEQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsZUFBZSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDOzJDQUcxRztBQVFEO0lBREMsUUFBUSxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDOzhDQUM3RjtBQUs3QjtJQURDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsQ0FBQzs0Q0FDdEM7QUFHNUI7SUFEQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsWUFBTyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLENBQUM7Z0RBQ3ZGO0FBRzlCO0lBREMsUUFBUSxDQUFDLEVBQUUsS0FBSyxFQUFFLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDOzRDQUNwQztBQUc1QjtJQURDLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxZQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQztrREFDakY7QUE5RXZCLGNBQWM7SUFEMUIsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0dBQ2IsY0FBYyxDQXdJMUI7QUF4SVksd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBfZGVjb3JhdG9yIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgRWZmZWN0QmFzZSB9IGZyb20gJy4vRWZmZWN0QmFzZSc7XG5pbXBvcnQgeyBDb2xvciB9IGZyb20gJ2NjJztcbmltcG9ydCB7IFRleHR1cmUyRCB9IGZyb20gJ2NjJztcbmltcG9ydCB7IE1hdGVyaWFsIH0gZnJvbSAnY2MnO1xuaW1wb3J0IHsgQ0NGbG9hdCB9IGZyb20gJ2NjJztcbmltcG9ydCB7IHR3ZWVuIH0gZnJvbSAnY2MnO1xuXG5jb25zdCB7IGNjY2xhc3MsIHByb3BlcnR5IH0gPSBfZGVjb3JhdG9yO1xuXG5AY2NjbGFzcygnRWZmZWN0RGlzc29sdmUnKVxuZXhwb3J0IGNsYXNzIEVmZmVjdERpc3NvbHZlIGV4dGVuZHMgRWZmZWN0QmFzZSB7XG4gICAgQHByb3BlcnR5KHsgdHlwZTogVGV4dHVyZTJELCB0b29sdGlwOiBcIuaMh+WumuWZquiBsuiyvOWcllwiIH0pXG4gICAgcHVibGljIG5vaXNlVGV4dHVyZTogVGV4dHVyZTJEIHwgbnVsbCA9IG51bGw7XG5cbiAgICAvLyNyZWdpb24gZGlzc29sdmVDb2xvclxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiU2V0dGVyL0dldHRlclwiLCBpZDogXCIxXCIgfSwgdG9vbHRpcDogXCLmurbop6PpoY/oibJcIiB9KVxuICAgIHB1YmxpYyBnZXQgZGlzc29sdmVDb2xvcigpOiBDb2xvciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kaXNzb2x2ZUNvbG9yO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgZGlzc29sdmVDb2xvcih2YWw6IENvbG9yKSB7XG4gICAgICAgIHRoaXMuX2Rpc3NvbHZlQ29sb3Iuc2V0KHZhbCk7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfZGlzc29sdmVDb2xvcicpO1xuICAgIH1cblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiUHJpdmF0ZSBQcm9wc1wiLCBpZDogXCIxXCIgfSwgdG9vbHRpcDogXCLmurbop6PpoY/oibJcIiwgdmlzaWJsZTogdHJ1ZSB9KVxuICAgIHByaXZhdGUgX2Rpc3NvbHZlQ29sb3I6IENvbG9yID0gbmV3IENvbG9yKDAsIDAsIDAsIDEpO1xuICAgIC8vI2VuZHJlZ2lvblxuXG5cbiAgICAvLyNyZWdpb24gZWZmZWN0RmFjdG9yXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJTZXR0ZXIvR2V0dGVyXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLCAxLCAwLjAxXSwgdG9vbHRpcDogXCLmurbop6PnqIvluqZcIiB9KVxuICAgIHB1YmxpYyBnZXQgZmFjdG9yKCk6IG51bWJlciB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mYWN0b3I7XG4gICAgfVxuXG4gICAgcHVibGljIHNldCBmYWN0b3IodmFsOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fZmFjdG9yID0gdmFsO1xuICAgICAgICB0aGlzLl9zZXRQYXJhbXNEaXJ0eSgnX2ZhY3RvcicpO1xuICAgIH1cblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiUHJpdmF0ZSBQcm9wc1wiLCBpZDogXCIxXCIgfSwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMCwgMSwgMC4wMV0sIHRvb2x0aXA6IFwi5rq26Kej56iL5bqmXCIsIHZpc2libGU6IHRydWUgfSlcbiAgICBwcml2YXRlIF9mYWN0b3I6IG51bWJlciA9IDAuNTtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgLy8jcmVnaW9uIHNvZnRuZXNzXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJTZXR0ZXIvR2V0dGVyXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLCAxLCAwLjAxXSwgdG9vbHRpcDogXCLmn5TpgornqIvluqZcIiB9KVxuICAgIHB1YmxpYyBnZXQgc29mdG5lc3MoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NvZnRuZXNzO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgc29mdG5lc3ModmFsOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fc29mdG5lc3MgPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfc29mdG5lc3MnKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHNsaWRlOiB0cnVlLCByYW5nZTogWzAsIDEsIDAuMDFdLCB0b29sdGlwOiBcIuaflOmCiueoi+W6plwiLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfc29mdG5lc3M6IG51bWJlciA9IDAuMTtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgLy8jcmVnaW9uIHdpZHRoXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJTZXR0ZXIvR2V0dGVyXCIsIGlkOiBcIjFcIiB9LCBzbGlkZTogdHJ1ZSwgcmFuZ2U6IFswLCAxLCAwLjAxXSwgdG9vbHRpcDogXCLmurbop6Plr6zluqZcIiB9KVxuICAgIHB1YmxpYyBnZXQgd2lkdGgoKTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dpZHRoO1xuICAgIH1cblxuICAgIHB1YmxpYyBzZXQgd2lkdGgodmFsOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5fd2lkdGggPSB2YWw7XG4gICAgICAgIHRoaXMuX3NldFBhcmFtc0RpcnR5KCdfd2lkdGgnKTtcbiAgICB9XG5cbiAgICBAcHJvcGVydHkoeyBncm91cDogeyBuYW1lOiBcIlByaXZhdGUgUHJvcHNcIiwgaWQ6IFwiMVwiIH0sIHNsaWRlOiB0cnVlLCByYW5nZTogWzAsIDEsIDAuMDFdLCB0b29sdGlwOiBcIua6tuino+WvrOW6plwiLCB2aXNpYmxlOiB0cnVlIH0pXG4gICAgcHJpdmF0ZSBfd2lkdGg6IG51bWJlciA9IDAuMTtcbiAgICAvLyNlbmRyZWdpb25cblxuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJBbmltXCIsIGlkOiBcIjJcIiB9LCB0b29sdGlwOiAn5piv5ZCm6Ieq5YuV5pKl5pS+JyB9KVxuICAgIHB1YmxpYyBwbGF5OiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiQW5pbVwiLCBpZDogXCIyXCIgfSwgdHlwZTogQ0NGbG9hdCwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMC4wMSwgMTAsIDAuMDFdLCB0b29sdGlwOiAn5oyB57ut5pe26Ze0JyB9KVxuICAgIHB1YmxpYyBkdXJhdGlvbjogbnVtYmVyID0gMS4wO1xuXG4gICAgQHByb3BlcnR5KHsgZ3JvdXA6IHsgbmFtZTogXCJBbmltXCIsIGlkOiBcIjJcIiB9LCB0b29sdGlwOiAn5piv5ZCm5b6q546vJyB9KVxuICAgIHB1YmxpYyBsb29wOiBib29sZWFuID0gdHJ1ZTtcblxuICAgIEBwcm9wZXJ0eSh7IGdyb3VwOiB7IG5hbWU6IFwiQW5pbVwiLCBpZDogXCIyXCIgfSwgdHlwZTogQ0NGbG9hdCwgc2xpZGU6IHRydWUsIHJhbmdlOiBbMCwgMTAsIDAuMV0sIHRvb2x0aXA6ICflvqrnjq/pl7TpmpQnIH0pXG4gICAgcHVibGljIGxvb3BfZGVsYXk6IG51bWJlciA9IDAuMDtcblxuXG4gICAgcHJvdGVjdGVkIF9pbnN0TWF0ZXJpYWwoKTogdm9pZCB7XG4gICAgICAgIGlmICh0aGlzLmVmZmVjdEFzc2V0KSB7XG4gICAgICAgICAgICBsZXQgbWF0ID0gbmV3IE1hdGVyaWFsKCk7XG4gICAgICAgICAgICBtYXQuaW5pdGlhbGl6ZSh7IFxuICAgICAgICAgICAgICAgIGVmZmVjdEFzc2V0OiB0aGlzLmVmZmVjdEFzc2V0LFxuICAgICAgICAgICAgICAgIHRlY2huaXF1ZTogdGhpcy5faXMyRGluM0QgPyAxIDogMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtYXQuc2V0UHJvcGVydHkoJ19ub2lzZXRleCcsIHRoaXMubm9pc2VUZXh0dXJlKTtcblxuICAgICAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfZGlzc29sdmVDb2xvcicsIG1hdC5wYXNzZXNbMF0uZ2V0SGFuZGxlKCdfZGlzc29sdmVDb2xvcicpKTtcbiAgICAgICAgICAgIHRoaXMuX3NldFBhcmFtcygnX2ZhY3RvcicsIG1hdC5wYXNzZXNbMF0uZ2V0SGFuZGxlKCdfZmFjdG9yJykpO1xuICAgICAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfc29mdG5lc3MnLCBtYXQucGFzc2VzWzBdLmdldEhhbmRsZSgnX3NvZnRuZXNzJykpO1xuICAgICAgICAgICAgdGhpcy5fc2V0UGFyYW1zKCdfd2lkdGgnLCBtYXQucGFzc2VzWzBdLmdldEhhbmRsZSgnX3dpZHRoJykpO1xuXG4gICAgICAgICAgICB0aGlzLl9zcHJpdGUhLmN1c3RvbU1hdGVyaWFsID0gbWF0O1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wbGF5KSB7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3BsYXkoKTtcbiAgICAgICAgICAgICAgICB9LCAxMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX3VwZGF0ZVBhcmFtcyhrZXk6IHN0cmluZywgaWR4OiBudW1iZXIpOiB2b2lkIHtcbiAgICAgICAgaWYgKGtleSA9PT0gJ19kaXNzb2x2ZUNvbG9yJykge1xuICAgICAgICAgICAgdGhpcy5fc3ByaXRlIS5tYXRlcmlhbD8ucGFzc2VzWzBdLnNldFVuaWZvcm0oaWR4LCB0aGlzLl9kaXNzb2x2ZUNvbG9yKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdfZmFjdG9yJykge1xuICAgICAgICAgICAgdGhpcy5fc3ByaXRlIS5tYXRlcmlhbD8ucGFzc2VzWzBdLnNldFVuaWZvcm0oaWR4LCB0aGlzLl9mYWN0b3IpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ19zb2Z0bmVzcycpIHtcbiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZSEubWF0ZXJpYWw/LnBhc3Nlc1swXS5zZXRVbmlmb3JtKGlkeCwgdGhpcy5fc29mdG5lc3MpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGtleSA9PT0gJ193aWR0aCcpIHtcbiAgICAgICAgICAgIHRoaXMuX3Nwcml0ZSEubWF0ZXJpYWw/LnBhc3Nlc1swXS5zZXRVbmlmb3JtKGlkeCwgdGhpcy5fd2lkdGgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfcGxheSgpOiB2b2lkIHtcbiAgICAgICAgbGV0IHR3ZWVuVGFyZ2V0ID0geyBmYWN0b3I6IDAuMCB9O1xuXG4gICAgICAgIHR3ZWVuKHR3ZWVuVGFyZ2V0KS50byh0aGlzLmR1cmF0aW9uLCB7IGZhY3RvcjogMS4wIH0sIHtcbiAgICAgICAgICAgIG9uVXBkYXRlOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5mYWN0b3IgPSB0d2VlblRhcmdldC5mYWN0b3I7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgb25Db21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvb3ApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZU9uY2UoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICB9LCB0aGlzLmxvb3BfZGVsYXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuc3RhcnQoKTtcbiAgICB9XG59XG5cblxuIl19